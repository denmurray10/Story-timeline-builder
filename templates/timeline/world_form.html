{% extends 'timeline/base.html' %}
{% load static %}

{% block title %}{% if is_edit %}Edit{% else %}Create{% endif %} Codex Entry{% endblock %}

{% block extra_css %}
<!-- Material Symbols & Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
    rel="stylesheet" />
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#136dec",
                    "background-light": "#F5F3F0",
                    "charcoal": "#2C3E50",
                },
                fontFamily: {
                    "display": ['"DM Serif Display"', "serif"],
                    "sans": ['"Inter"', "sans-serif"],
                },
            },
        },
    }
</script>
<style>
    body {
        font-family: "Inter", sans-serif;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        font-family: "DM Serif Display", serif;
    }

    .container-fluid {
        padding: 0 !important;
    }

    .row {
        margin: 0 !important;
    }

    aside a {
        text-decoration: none !important;
    }

    /* Form styling overrides */
    input[type="text"],
    select,
    textarea {
        @apply w-full bg-white border-[#D8D4CE] rounded-lg py-3 px-4 text-sm text-charcoal focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all shadow-sm;
    }

    label {
        @apply block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2;
    }

    .help-text {
        @apply mt-2 text-xs text-slate-400 italic;
    }

    .error-text {
        @apply mt-1 text-xs text-red-500 font-medium;
    }
</style>
{% endblock %}

{% block full_layout %}
<div class="bg-background-light text-charcoal min-h-screen flex overflow-hidden w-full">
    <!-- Sidebar -->
    <aside class="w-64 bg-[#EBE9E6] border-r border-[#D8D4CE] flex flex-col justify-between shrink-0 h-screen z-20">
        <div class="flex flex-col gap-6 p-6">
            <div class="flex items-center gap-3 mb-2">
                <div class="bg-primary/10 flex items-center justify-center rounded-lg size-10 text-primary">
                    <span class="material-symbols-outlined fill">menu_book</span>
                </div>
                <div class="flex flex-col">
                    <h1 class="text-charcoal text-lg font-bold leading-tight">World Codex</h1>
                    <p class="text-slate-500 text-xs font-medium">{{ user.username }}'s Story Bible</p>
                </div>
            </div>
            <nav class="flex flex-col gap-2">
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-charcoal hover:bg-white/60 transition-colors group"
                    href="{% url 'world_list' %}">
                    <span class="material-symbols-outlined text-slate-500 group-hover:text-primary">folder_open</span>
                    <span class="text-sm font-bold">All Archives</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-charcoal hover:bg-white/60 transition-colors group"
                    href="{% url 'dashboard' %}">
                    <span class="material-symbols-outlined text-slate-500 group-hover:text-primary">arrow_back</span>
                    <span class="text-sm font-medium">Back to Studio</span>
                </a>
            </nav>
        </div>
    </aside>

    <!-- Content Area -->
    <main class="flex-1 overflow-y-auto bg-[#F5F3F0]">
        <!-- Top Toolbar -->
        <div
            class="h-20 px-8 flex items-center justify-between border-b border-[#E0DCD6] bg-background-light/80 backdrop-blur-sm sticky top-0 z-10">
            <div class="flex items-center gap-4">
                <a href="{% if is_edit %}{% url 'world_detail' entry.pk %}{% else %}{% url 'world_list' %}{% endif %}"
                    class="size-10 rounded-full flex items-center justify-center text-slate-500 hover:bg-black/5 hover:text-charcoal transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </a>
                <h2 class="text-xl font-bold text-charcoal tracking-tight">{% if is_edit %}Edit Entry{% else %}Create
                    New Entry{% endif %}</h2>
            </div>
            <div class="flex items-center gap-3">
                <button type="submit" form="codexForm"
                    class="bg-charcoal hover:bg-black text-white px-6 py-2.5 rounded-lg text-sm font-bold shadow-md flex items-center gap-2 transition-all transform hover:-translate-y-0.5">
                    <span class="material-symbols-outlined text-[20px]">check</span>
                    <span>{% if is_edit %}Save Changes{% else %}Publish Entry{% endif %}</span>
                </button>
            </div>
        </div>

        <div class="max-w-3xl mx-auto py-12 px-6">
            <div class="bg-white rounded-2xl shadow-sm border border-[#E0DCD6] p-8 md:p-12">
                <form id="codexForm" method="post" enctype="multipart/form-data" class="flex flex-col gap-8">
                    {% csrf_token %}

                    {% for field in form %}
                    <div class="flex flex-col">
                        <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                        {{ field }}
                        {% if field.help_text %}
                        <p class="help_text">{{ field.help_text }}</p>
                        {% endif %}
                        {% for error in field.errors %}
                        <p class="error-text">{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endfor %}
                </form>
            </div>
        </div>
    </main>
</div>

<script>
    // Simple script to inject Tailwind classes into Django form fields if they don't have them
    document.addEventListener('DOMContentLoaded', function () {
        const inputs = document.querySelectorAll('input[type="text"], input[type="file"], select, textarea');
        inputs.forEach(input => {
            input.classList.add('w-full', 'bg-white', 'border-[#D8D4CE]', 'rounded-lg', 'py-3', 'px-4', 'text-sm', 'text-charcoal', 'focus:ring-2', 'focus:ring-primary/20', 'focus:border-primary', 'transition-all', 'shadow-sm');
        });
    });
</script>
{% endblock %}