{% extends 'timeline/base.html' %}
{% load static %}

{% block title %}Chapters - Story Timeline Builder{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-list-ol"></i> Chapters</h1>
</div>

{% if books %}
{% for book in books %}
<div class="card mb-4 shadow-sm">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="bi bi-book me-2"></i>
            <a href="{% url 'book_detail' book.pk %}" class="text-decoration-none text-dark">
                {{ book.title }}
            </a>
        </h5>
        <span class="badge bg-secondary">{{ book.status }}</span>
    </div>
    <div class="card-body p-0">
        <div class="list-group list-group-flush">
            {% for chapter in book.chapters.all %}
            <div class="list-group-item list-group-item-action border-0 border-bottom px-4 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">
                            <a href="{% url 'chapter_detail' chapter.pk %}"
                                class="text-decoration-none text-dark fw-bold">
                                Chapter {{ chapter.chapter_number }}: {{ chapter.title }}
                            </a>
                        </h6>
                        {% if chapter.description %}
                        <p class="mb-1 small text-muted text-truncate" style="max-width: 600px;">
                            {{ chapter.description }}
                        </p>
                        {% endif %}
                        <div class="d-flex gap-3 mt-1">
                            <small class="text-muted"><i class="bi bi-fonts"></i> {{ chapter.word_count }} words</small>
                            <small class="text-muted"><i class="bi bi-calendar-event"></i> {{ chapter.events.count }}
                                events</small>
                            {% if chapter.is_complete %}
                            <span class="badge bg-success-subtle text-success py-1 px-2">Complete</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="btn-group">
                        <a href="{% url 'chapter_edit' chapter.pk %}" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{% url 'chapter_delete' chapter.pk %}" class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="p-4 text-center text-muted">
                <p class="mb-2">No chapters yet for this book.</p>
                <a href="{% url 'chapter_create' book.pk %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-plus-lg"></i> Add First Chapter
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% if book.chapters.exists %}
    <div class="card-footer bg-white text-end">
        <a href="{% url 'chapter_create' book.pk %}" class="btn btn-sm btn-primary">
            <i class="bi bi-plus-lg"></i> Add Chapter
        </a>
    </div>
    {% endif %}
</div>
{% endfor %}
{% else %}
<div class="card border-0 shadow-sm rounded-4">
    <div class="card-body text-center py-5">
        <i class="bi bi-book display-1 text-muted opacity-25"></i>
        <h3 class="mt-3">No Books Found</h3>
        <p class="text-muted mb-4">Create a book first to start adding chapters.</p>
        <a href="{% url 'book_create' %}" class="btn btn-primary btn-lg rounded-pill px-4">
            <i class="bi bi-plus-circle me-1"></i> Create Your First Book
        </a>
    </div>
</div>
{% endif %}

{% endblock %}