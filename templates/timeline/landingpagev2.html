{% load static %}
<!DOCTYPE html>
<html class="scroll-smooth" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Story Timeline Builder - Developer UI Specs V1</title>
    <meta content="AI-powered writing platform for storytellers. Plan, draft, and polish your fictional world."
        name="description" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&amp;family=Inter:wght@300;400;500;600;700&amp;family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#333333", // Dark charcoal for primary buttons/text
                        accent: "#F4EBD9", // Warm highlight
                        "background-light": "#F2F0EB", // Warm grey/beige background from screenshot
                        "background-dark": "#121212", // Deep dark background
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#1E1E1E",
                        "text-light": "#333333",
                        "text-dark": "#E0E0E0",
                        "border-light": "#E5E5E5",
                        "border-dark": "#333333",
                        "green-success": "#4CAF50",
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['DM Serif Display', 'serif'], // For Headlines
                        display: ['Playfair Display', 'serif'], // For italic accents
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                        'xl': '0.75rem',
                        '2xl': '1rem',
                        '3xl': '1.5rem',
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 10px 30px -5px rgba(0, 0, 0, 0.08)',
                    }
                },
            },
        };
        // Hero Mockup Interactivity: Selection -> Toolbar -> Analytics -> Rewrite
        document.addEventListener('DOMContentLoaded', function () {
            const writingSurface = document.getElementById('mockup-writing-surface');
            const ghostwriterPanel = document.getElementById('mockup-ghostwriter-panel');
            const ghostwriterBars = document.getElementById('ghostwriter-bars');
            const ghostwriterSuggestion = document.getElementById('ghostwriter-suggestion');
            const insightCard = document.getElementById('codex-insight-card');
            const insightTitle = document.getElementById('codex-insight-title');
            const insightText = document.getElementById('codex-insight-text');
            const askPopup = document.getElementById('ghostwriter-ask-popup');
            const formatBubble = document.getElementById('format-bubble');
            const acceptBtn = document.getElementById('btn-accept-rewrite');
            const mockupContainer = formatBubble ? formatBubble.parentElement : null;

            const flowGauge = document.getElementById('flow-gauge');
            const flowLabel = document.getElementById('flow-label');
            const tempoGauge = document.getElementById('tempo-gauge');
            const tempoLabel = document.getElementById('tempo-label');
            const castAdded = document.getElementById('cast-added');

            let lastSelectionRange = null;

            window.simulateTextSize = function (size) {
                if (lastSelectionRange) {
                    const span = document.createElement('span');
                    span.style.fontSize = size === 'large' ? '1.25em' : '0.85em';
                    span.classList.add('transition-all', 'duration-500');
                    lastSelectionRange.surroundContents(span);
                    formatBubble.classList.add('hidden');
                }
            };

            if (writingSurface && mockupContainer) {
                writingSurface.addEventListener('mouseup', function (e) {
                    const selection = window.getSelection();
                    const text = selection.toString().trim();

                    if (text.length > 5) {
                        lastSelectionRange = selection.getRangeAt(0).cloneRange();

                        const rect = selection.getRangeAt(0).getBoundingClientRect();
                        const parentRect = mockupContainer.getBoundingClientRect();

                        // 1. Show Formatting Bubble (Relative to mockup container)
                        formatBubble.style.left = `${rect.left - parentRect.left + (rect.width / 2) - 60}px`;
                        formatBubble.style.top = `${rect.top - parentRect.top - 45}px`;
                        formatBubble.classList.remove('hidden');

                        // 2. Update Analytics
                        if (flowGauge) {
                            flowGauge.style.width = '42%';
                            flowLabel.innerText = '42%';
                            flowLabel.classList.add('text-red-500');
                        }
                        if (tempoGauge) {
                            tempoGauge.style.width = '80%';
                            tempoLabel.innerText = 'Fast';
                            tempoLabel.classList.add('text-yellow-500');
                        }

                        // 3. Update The Guide
                        if (insightCard) {
                            insightCard.classList.add('ring-2', 'ring-blue-500/20', 'bg-blue-100/30');
                            insightTitle.innerText = "Narrative Polish";
                            insightText.innerText = "The pacing here is erratic. Consider smoothing the transition to highlight character interiority.";
                        }

                        // 4. Show the Ghostwriter Popup
                        setTimeout(() => {
                            askPopup.style.left = `${rect.left - parentRect.left + (rect.width / 2) - 80}px`;
                            askPopup.style.top = `${rect.top - parentRect.top + rect.height + 10}px`;
                            askPopup.classList.remove('hidden');
                        }, 400);

                        if (ghostwriterPanel) ghostwriterPanel.classList.add('ring-2', 'ring-blue-500/10');
                    }
                });
            }

            if (acceptBtn) {
                acceptBtn.addEventListener('click', function () {
                    if (lastSelectionRange) {
                        const replacement = document.createElement('span');
                        replacement.className = 'text-blue-600 dark:text-blue-400 font-medium animate-in fade-in duration-1000';
                        replacement.innerText = "The wind whispered names Elena had spent years trying to bury.";

                        lastSelectionRange.deleteContents();
                        lastSelectionRange.insertNode(replacement);

                        askPopup.classList.add('hidden');
                        formatBubble.classList.add('hidden');

                        if (flowGauge) {
                            flowGauge.style.width = '92%';
                            flowLabel.innerText = '92%';
                            flowLabel.classList.remove('text-red-500');
                            flowLabel.classList.add('text-green-600');
                        }
                        if (tempoGauge) {
                            tempoGauge.style.width = '55%';
                            tempoLabel.innerText = 'Ideal';
                            tempoLabel.classList.remove('text-yellow-500');
                        }
                        if (castAdded) castAdded.classList.remove('opacity-0');

                        if (ghostwriterPanel) {
                            ghostwriterBars.classList.add('hidden');
                            ghostwriterSuggestion.classList.remove('hidden');
                            ghostwriterPanel.classList.add('bg-green-50/30', 'dark:bg-green-900/10', 'border-green-100/50', 'dark:border-green-800/30');
                        }

                        window.getSelection().removeAllRanges();
                    }
                });
            }

            document.addEventListener('mousedown', function (e) {
                if (askPopup && !askPopup.contains(e.target) && !formatBubble.contains(e.target) && !writingSurface.contains(e.target)) {
                    askPopup.classList.add('hidden');
                    formatBubble.classList.add('hidden');
                }
            });

            // Writing Mode Hierarchical Logic
            window.switchPillState = function (state) {
                const states = ['standard-tools', 'ai-main', 'ai-drafting', 'ai-refine', 'ai-analysis'];
                states.forEach(s => {
                    const el = document.getElementById(`pill-${s}`);
                    if (el) {
                        el.classList.add('hidden');
                        el.classList.remove('flex');
                    }
                });

                const target = document.getElementById(`pill-${state}`);
                const pill = document.getElementById('writing-pill');

                if (target) {
                    target.classList.remove('hidden');
                    target.classList.add('flex');
                }

                // Visual transition for AI modes
                if (state !== 'standard-tools') {
                    pill.classList.add('bg-blue-50/50', 'border-blue-100');
                } else {
                    pill.classList.remove('bg-blue-50/50', 'border-blue-100');
                }
            };
        });
    </script>
    <style>
        .glass-panel {
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.7);
        }

        .dark .glass-panel {
            background: rgba(30, 30, 30, 0.7);
        }

        .h-20 {
            height: 8rem;
        }

        /* Reveal Animations */
        .reveal {
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform, opacity;
        }

        .fade-in {
            transform: translateY(0);
        }

        .slide-up {
            transform: translateY(40px);
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        .delay-100 {
            transition-delay: 100ms;
        }

        .delay-200 {
            transition-delay: 200ms;
        }

        .delay-300 {
            transition-delay: 300ms;
        }

        .delay-400 {
            transition-delay: 400ms;
        }

        .delay-500 {
            transition-delay: 500ms;
        }

        @media (min-width: 768px) {
            .md\:rounded-3xl {
                border-radius: 1.5rem !important;
                margin-top: 40px !important;
                margin-bottom: 80px !important;
            }
        }

        /* Hero Zen Mode Styles */
        #hero-left-sidebar,
        #hero-right-sidebar {
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* In Zen Mode, hide sidebars by default and make them absolute */
        .hero-zen-active #hero-left-sidebar {
            position: absolute !important;
            left: 0;
            top: 0;
            height: 100%;
            transform: translateX(-100%) translateX(2px);
            z-index: 50;
        }

        .hero-zen-active #hero-left-sidebar:hover {
            transform: translateX(0);
        }

        .hero-zen-active #hero-right-sidebar {
            position: absolute !important;
            right: 0;
            top: 0;
            height: 100%;
            transform: translateX(100%) translateX(-2px);
            z-index: 50;
        }

        .hero-zen-active #hero-right-sidebar:hover {
            transform: translateX(0);
        }

        /* Ensure editor fills space when sidebars are absolute */
        .hero-zen-active #mockup-writing-surface {
            padding-left: 10%;
            padding-right: 10%;
        }

        /* Hide secondary floating elements in Zen */
        .hero-zen-active #format-bubble,
        .hero-zen-active #ghostwriter-ask-popup,
        .hero-zen-active #grammar-popup {
            opacity: 0 !important;
            pointer-events: none !important;
            transition: all 0.3s ease;
        }

        /* Grammarly-style Highlights */
        .grammar-error {
            text-decoration: underline wavy #ff4d4d;
            text-decoration-thickness: 1.5px;
            text-underline-offset: 4px;
            cursor: pointer;
        }

        .spelling-error {
            text-decoration: underline wavy #ff4d4d;
            text-decoration-thickness: 1.5px;
            text-underline-offset: 4px;
            cursor: pointer;
        }

        .style-suggestion {
            background-color: rgba(147, 51, 234, 0.1);
            border-bottom: 2px solid rgba(147, 51, 234, 0.3);
            cursor: pointer;
        }

        /* Walkthrough sequential logic */
        .walkthrough-inactive {
            text-decoration: none !important;
            background-color: transparent !important;
            border-bottom: none !important;
            cursor: default !important;
            pointer-events: none !important;
        }

        .spelling-error {
            text-decoration: underline wavy #fac120;
            text-decoration-thickness: 1.5px;
            text-underline-offset: 4px;
            cursor: pointer;
        }

        /* Style Suggestions */
        .style-suggestion {
            background-color: rgba(139, 92, 246, 0.08);
            /* Soft purple */
            border-bottom: 1.5px dashed #8b5cf6;
            cursor: help;
        }

        .dark .style-suggestion {
            background-color: rgba(139, 92, 246, 0.15);
        }

        /* Nav Padding Scroll Logic */
        nav {
            top: 50px !important;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1) !important;
        }

        nav.scrolled {
            top: 0 !important;
        }

        .dark nav.scrolled {
            top: 0 !important;
        }

        /* Zen Mode Demo Styles */
        #writing-pad-mockup.zen-mode-active #mockup-sidebar {
            display: none !important;
        }

        #writing-pad-mockup.zen-mode-active .flex-1 {
            padding-left: 10%;
            padding-right: 10%;
        }

        /* Relationship Drawer Styles */
        .map-hotspot {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .map-hotspot:hover {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.4);
        }

        /* Custom Scrollbar - Hidden by default, slim on hover */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(147, 51, 234, 0.2);
            border-radius: 10px;
        }

        .custom-scrollbar:hover::-webkit-scrollbar-thumb {
            background: rgba(147, 51, 234, 0.4);
        }

        @keyframes bounce-slow {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes pulse-slow {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.9;
                transform: scale(0.98);
            }
        }

        .animate-bounce-slow {
            animation: bounce-slow 3s infinite ease-in-out;
        }

        .animate-pulse-slow {
            animation: pulse-slow 4s infinite ease-in-out;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none !important;
        }

        .no-scrollbar {
            -ms-overflow-style: none !important;
            scrollbar-width: none !important;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes pulse-subtle {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        .animate-pulse-subtle {
            animation: pulse-subtle 4s ease-in-out infinite;
        }

        /* Ghostwriter Rewrite Popup */
        #ghostwriter-ask-popup {
            filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.1));
            z-index: 100;
        }

        .highlight-active {
            background-color: rgba(59, 130, 246, 0.2);
            border-bottom: 2px solid rgba(59, 130, 246, 0.5);
            transition: all 0.3s ease;
        }

        .text-rewriting {
            transition: opacity 0.5s ease;
            opacity: 0;
        }

        /* Formatting Bubble */
        #format-bubble {
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
            z-index: 110;
        }

        /* Analytics Gauges */
        .gauge-bar {
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .dark .gauge-bar {
            background: #374151;
        }

        .gauge-fill {
            height: 100%;
            transition: width 1.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark font-sans transition-colors duration-300 antialiased selection:bg-accent selection:text-primary">
    <nav id="main-nav"
        class="fixed w-full z-50 left-0 bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-md border-b border-transparent">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <a href="{% url 'landing_page_v2' %}" class="flex-shrink-0 flex items-center cursor-pointer">
                    <img src="{% static 'img/logo.webp' %}" alt="Story Timeline Builder"
                        style="height: 3.5rem; width: auto;">
                </a>
                <div class="hidden md:flex items-center space-x-8">
                    <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white transition-colors"
                        href="#">Features</a>
                    <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white transition-colors"
                        href="#">Pricing</a>
                    <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white transition-colors"
                        href="#">Resources</a>
                    <a class="bg-primary text-white dark:bg-white dark:text-primary px-5 py-2.5 rounded-full text-sm font-medium hover:opacity-90 transition-opacity shadow-sm"
                        href="{% url 'login' %}">Start Writing</a>
                </div>
                <div class="md:hidden flex items-center">
                    <button class="text-primary dark:text-white p-2">
                        <span class="material-icons-outlined">menu</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <section class="pt-[258px] pb-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col items-center text-center">
            <div
                class="reveal fade-in inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white dark:bg-surface-dark border border-gray-200 dark:border-border-dark shadow-sm mb-8">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-xs font-semibold tracking-wide uppercase text-gray-500 dark:text-gray-400">v2.0 Now
                    Available</span>
            </div>
            <h1
                class="reveal slide-up delay-100 text-5xl md:text-7xl font-serif text-primary dark:text-white mb-6 leading-tight max-w-4xl mx-auto">
                Contextual Intelligence <br />
                <span class="font-display italic font-normal text-gray-600 dark:text-gray-300">for your fictional
                    world</span>
            </h1>
            <p
                class="reveal slide-up delay-200 text-lg md:text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto mb-10 leading-[1.4rem]">
                Transcend the fragmentation of traditional drafting. Collaborate with an intelligence that comprehends
                the deep history, emotional resonance, and invisible architecture of your narrative.
            </p>
            <div class="reveal slide-up delay-300 flex flex-col sm:flex-row items-center gap-4 mb-20">
                <a class="bg-primary text-white dark:bg-white dark:text-primary px-8 py-3.5 rounded-full font-medium hover:scale-105 transition-transform duration-200 shadow-md flex items-center gap-2"
                    href="{% url 'login' %}">
                    Start Writing <span class="material-icons-outlined text-sm">arrow_forward</span>
                </a>
                <a class="bg-white dark:bg-surface-dark text-primary dark:text-white border border-gray-200 dark:border-border-dark px-8 py-3.5 rounded-full font-medium hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors shadow-sm flex items-center gap-2"
                    href="#">
                    <span class="material-icons-outlined">play_circle_outline</span> Watch Demo
                </a>
            </div>
            <div class="reveal slide-up delay-500 relative w-full max-w-7xl mx-auto">
                <div id="hero-writing-mockup"
                    class="relative rounded-xl md:rounded-3xl overflow-hidden transform scale-100 md:scale-105 bg-white dark:bg-surface-dark shadow-[0_50px_100px_-20px_rgba(0,0,0,0.15)] border border-gray-200 dark:border-gray-800 aspect-[16/10] flex flex-col font-sans">
                    <!-- Top Bar (Mac Style) -->
                    <div
                        class="h-8 bg-gray-50 dark:bg-surface-dark border-b border-gray-200 dark:border-white/5 flex items-center px-4 gap-1.5 shrink-0">
                        <div class="w-2.5 h-2.5 rounded-full bg-red-400/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-yellow-400/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-green-400/50"></div>
                        <div class="mx-auto text-[10px] text-gray-400 font-medium tracking-wide">STORY TIMELINE BUILDER
                            — WRITING MODE</div>
                    </div>

                    <div class="flex flex-1 overflow-hidden relative">

                        <!-- Left Nav (Story OS Production Bar) -->
                        <div id="hero-left-sidebar"
                            class="w-12 bg-gray-50 dark:bg-black border-r border-gray-200 dark:border-white/5 flex flex-col items-center py-6 gap-8 shrink-0 lg:w-16 transition-all duration-500 z-40">
                            <div class="group relative cursor-pointer" title="Story Bible">
                                <span
                                    class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">menu_book</span>
                                <div
                                    class="absolute left-full ml-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    Codex Wiki</div>
                            </div>
                            <div class="relative cursor-pointer" title="Manuscript">
                                <span class="material-icons-outlined text-blue-500 text-lg">edit_note</span>
                                <div
                                    class="absolute -right-1 top-0 w-1.5 h-1.5 bg-blue-500 rounded-full border-2 border-gray-50 animate-pulse">
                                </div>
                            </div>
                            <div class="group relative cursor-pointer" title="Version History">
                                <span
                                    class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">history</span>
                                <div
                                    class="absolute left-full ml-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    Draft Management</div>
                            </div>
                            <div class="group relative cursor-pointer" title="Analysis">
                                <span
                                    class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">analytics</span>
                                <div
                                    class="absolute left-full ml-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    Deep Analysis</div>
                            </div>
                            <div class="group relative cursor-pointer" title="Publishing">
                                <span
                                    class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">file_download</span>
                                <div
                                    class="absolute left-full ml-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    Export & Publish</div>
                            </div>
                            <div class="mt-auto flex flex-col items-center gap-6">
                                <div id="hero-zen-toggle" class="cursor-pointer group relative" title="Zen Mode">
                                    <span
                                        class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">self_improvement</span>
                                    <div
                                        class="absolute left-full ml-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                        Zen Mode</div>
                                </div>
                                <div id="hero-theme-toggle" class="cursor-pointer group relative" title="Toggle Theme">
                                    <span
                                        class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">dark_mode</span>
                                    <div
                                        class="absolute left-full ml-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                        Toggle Theme</div>
                                </div>
                                <span
                                    class="material-icons-outlined text-gray-300 text-lg cursor-pointer hover:text-gray-500 transition-colors">settings</span>
                            </div>
                        </div>

                        <!-- Main Editor -->
                        <div
                            class="flex-1 flex flex-col bg-background-light dark:bg-background-dark overflow-hidden relative">
                            <!-- Responsive Multi-Stage Writing Pill (Centered relative to text) -->
                            <div class="absolute inset-x-0 top-[70px] flex justify-center pointer-events-none z-50">
                                <div id="writing-pill"
                                    class="pointer-events-auto h-11 flex items-center gap-4 px-6 bg-white dark:bg-surface-dark rounded-full shadow-2xl border border-gray-100 dark:border-white/5 whitespace-nowrap transition-all duration-300">

                                    <!-- STAGE 1: Standard Tools -->
                                    <div id="pill-standard-tools" class="flex items-center gap-4 h-full">
                                        <div
                                            class="flex items-center gap-3 pr-4 border-r border-gray-100 dark:border-white/5 h-6">
                                            <div
                                                class="flex items-center gap-1 cursor-pointer hover:text-blue-500 transition-colors">
                                                <span
                                                    class="text-[11px] font-bold text-gray-700 dark:text-gray-300">OpenDyslexic</span>
                                                <span
                                                    class="material-icons-outlined text-[14px] text-gray-400">expand_more</span>
                                            </div>
                                            <div
                                                class="flex items-center gap-1 cursor-pointer hover:text-blue-500 transition-colors">
                                                <span
                                                    class="material-icons-outlined text-[16px] text-gray-500">format_line_spacing</span>
                                            </div>
                                            <div
                                                class="flex items-center gap-1 cursor-pointer hover:text-blue-500 transition-colors border-l border-gray-100 dark:border-gray-800 pl-3">
                                                <span
                                                    class="text-[11px] font-bold text-gray-700 dark:text-gray-300">18</span>
                                                <span
                                                    class="material-icons-outlined text-[14px] text-gray-400">expand_more</span>
                                            </div>
                                        </div>
                                        <div
                                            class="flex items-center gap-3 pr-4 border-r border-gray-100 dark:border-gray-800 h-6">
                                            <button
                                                class="text-[10px] font-black text-gray-400 hover:text-blue-500 transition-colors tracking-tighter">H1</button>
                                            <button
                                                class="text-[10px] font-black text-gray-400 hover:text-blue-500 transition-colors tracking-tighter">H2</button>
                                            <button
                                                class="text-[10px] font-black text-gray-400 hover:text-blue-500 transition-colors tracking-tighter">H3</button>
                                        </div>
                                        <div
                                            class="flex items-center gap-3 pr-4 border-r border-gray-100 dark:border-gray-800 h-6">
                                            <span
                                                class="material-icons-outlined text-[18px] text-gray-500 hover:text-blue-500 cursor-pointer">format_bold</span>
                                            <span
                                                class="material-icons-outlined text-[18px] text-gray-500 hover:text-blue-500 cursor-pointer">format_italic</span>
                                            <span
                                                class="material-icons-outlined text-[18px] text-gray-400 hover:text-blue-500 cursor-pointer">format_list_bulleted</span>
                                            <span
                                                class="material-icons-outlined text-[18px] text-gray-400 hover:text-blue-500 cursor-pointer">format_quote</span>
                                        </div>
                                        <!-- Narrative Engine Entry -->
                                        <button onclick="switchPillState('ai-main')"
                                            class="flex items-center gap-2 text-green-600 hover:text-green-700 transition-colors group">
                                            <span
                                                class="material-icons-outlined text-[16px] group-hover:rotate-12 transition-transform">history_edu</span>
                                            <span class="text-[10px] font-black tracking-widest uppercase">Penn</span>
                                        </button>
                                    </div>

                                    <!-- STAGE 2: AI Main Menu -->
                                    <div id="pill-ai-main"
                                        class="hidden items-center gap-4 animate-in fade-in slide-in-from-bottom-2 duration-300 h-full">
                                        <button onclick="switchPillState('standard-tools')"
                                            class="p-1 px-2 rounded-lg bg-gray-50 dark:bg-gray-800 text-gray-400 hover:text-gray-600 transition-colors">
                                            <span class="material-icons-outlined text-[14px]">arrow_back</span>
                                        </button>
                                        <div class="flex items-center gap-2">
                                            <div onclick="switchPillState('ai-drafting')"
                                                class="flex items-center gap-2 px-3 py-1 rounded-lg bg-green-600 text-white text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-green-700 shadow-sm transition-all whitespace-nowrap">
                                                <span class="material-icons-outlined text-[14px]">menu_book</span>
                                                Drafting
                                            </div>
                                            <div onclick="switchPillState('ai-refine')"
                                                class="flex items-center gap-2 px-3 py-1 rounded-lg border border-gray-100 dark:border-gray-800 text-gray-600 dark:text-gray-300 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-all whitespace-nowrap">
                                                <span class="material-icons-outlined text-[14px]">diamond</span>
                                                Refinement
                                            </div>
                                            <div onclick="switchPillState('ai-analysis')"
                                                class="flex items-center gap-2 px-3 py-1 rounded-lg border border-gray-100 dark:border-gray-800 text-gray-600 dark:text-gray-300 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-all whitespace-nowrap">
                                                <span class="material-icons-outlined text-[14px]">analytics</span>
                                                Analysis
                                            </div>
                                        </div>
                                    </div>

                                    <!-- STAGE 3: AI Drafting Sub-Menu -->
                                    <div id="pill-ai-drafting"
                                        class="hidden items-center gap-3 animate-in fade-in slide-in-from-right-2 duration-300 h-full">
                                        <button onclick="switchPillState('ai-main')"
                                            class="p-1 px-2 rounded-lg bg-gray-50 dark:bg-gray-800 text-gray-400 hover:text-gray-600 transition-colors">
                                            <span class="material-icons-outlined text-[14px]">arrow_back</span>
                                        </button>
                                        <div class="flex items-center gap-2">
                                            <div
                                                class="px-3 py-1 rounded-lg border border-blue-200 bg-blue-50 text-blue-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-blue-100 shadow-sm transition-all whitespace-nowrap">
                                                Guided Draft</div>
                                            <div
                                                class="px-3 py-1 rounded-lg border border-gray-100 text-gray-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 transition-all whitespace-nowrap">
                                                Expand</div>
                                            <div
                                                class="px-3 py-1 rounded-lg border border-gray-100 text-gray-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 transition-all whitespace-nowrap">
                                                Dialogue Polish</div>
                                        </div>
                                    </div>

                                    <!-- STAGE 4: AI Refinement Sub-Menu -->
                                    <div id="pill-ai-refine"
                                        class="hidden items-center gap-3 animate-in fade-in slide-in-from-right-2 duration-300 h-full">
                                        <button onclick="switchPillState('ai-main')"
                                            class="p-1 px-2 rounded-lg bg-gray-50 dark:bg-gray-800 text-gray-400 hover:text-gray-600 transition-colors">
                                            <span class="material-icons-outlined text-[14px]">arrow_back</span>
                                        </button>
                                        <div class="flex items-center gap-2">
                                            <div
                                                class="px-3 py-1 rounded-lg border border-gray-100 text-gray-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 transition-all whitespace-nowrap">
                                                Show Don't Tell</div>
                                            <div
                                                class="px-3 py-1 rounded-lg border border-gray-100 text-gray-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 transition-all whitespace-nowrap">
                                                Sensory Detail</div>
                                            <div
                                                class="px-3 py-1 rounded-lg border border-gray-100 text-gray-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 transition-all whitespace-nowrap">
                                                Continuity Check</div>
                                        </div>
                                    </div>

                                    <!-- STAGE 5: AI Analysis Sub-Menu -->
                                    <div id="pill-ai-analysis"
                                        class="hidden items-center gap-3 animate-in fade-in slide-in-from-right-2 duration-300 h-full">
                                        <button onclick="switchPillState('ai-main')"
                                            class="p-1 px-2 rounded-lg bg-gray-50 dark:bg-gray-800 text-gray-400 hover:text-gray-600 transition-colors">
                                            <span class="material-icons-outlined text-[14px]">arrow_back</span>
                                        </button>
                                        <div class="flex items-center gap-2">
                                            <div
                                                class="px-3 py-1 rounded-lg border border-gray-100 text-gray-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 transition-all whitespace-nowrap">
                                                Pacing Pulse</div>
                                            <div
                                                class="px-3 py-1 rounded-lg border border-gray-100 text-gray-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 transition-all whitespace-nowrap">
                                                Active Voice</div>
                                            <div
                                                class="px-3 py-1 rounded-lg border border-gray-100 text-gray-600 text-[10px] font-bold tracking-widest uppercase cursor-pointer hover:bg-gray-50 transition-all whitespace-nowrap">
                                                Repetition Check</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Editor Header -->
                            <div
                                class="h-10 flex items-center justify-between px-8 border-b border-gray-200/50 dark:border-white/5 shrink-0">
                                <div class="text-[11px] font-bold text-gray-400 tracking-[0.2em] uppercase">Draft v2.4 /
                                    ch_14 / scene_03</div>
                                <div class="flex gap-4 items-center">
                                    <div class="text-[10px] font-bold text-blue-500/60 tracking-wider">SYNC ACTIVE</div>
                                    <div class="h-1.5 w-12 bg-blue-100 dark:bg-blue-900/30 rounded-full"></div>
                                </div>
                            </div>

                            <!-- Writing Pad -->
                            <div class="flex-1 flex overflow-hidden">
                                <!-- Marker Gutter (Timeline Navigation) -->
                                <div
                                    class="w-10 border-r border-gray-100 dark:border-white/5 flex flex-col items-center py-40 gap-4 opacity-50">
                                    <div class="w-1 h-32 bg-gray-100 dark:bg-gray-800 rounded-full relative">
                                        <div class="absolute top-8 left-0 w-full h-4 bg-red-400 rounded-full cursor-help"
                                            title="Plot Hole detected"></div>
                                        <div class="absolute top-20 left-0 w-full h-2 bg-blue-400 rounded-full cursor-help"
                                            title="Character Note"></div>
                                    </div>
                                    <span class="material-icons-outlined text-[14px] text-gray-300">expand_more</span>
                                </div>

                                <div id="mockup-writing-surface"
                                    class="flex-1 overflow-y-auto pt-[104px] pb-24 px-12 md:px-20 lg:px-24 custom-scrollbar selection:bg-blue-200/50 dark:selection:bg-blue-500/30">
                                    <div class="max-w-xl mx-auto relative">
                                        <h1
                                            class="text-3xl md:text-custom font-serif text-primary dark:text-white mb-10 font-bold leading-tight">
                                            The Cathedral of Dust</h1>
                                        <div id="editable-mockup"
                                            class="space-y-6 text-gray-700 dark:text-gray-300 leading-[1.7] text-[15px] selection:bg-blue-100 dark:selection:bg-blue-900/30">
                                            <p
                                                data-goal="The wind did not merely howl across the plains; it whispered the names Elena had spent a decade trying to bury. It carried the scent of ozone and ancient parchment, the unmistakable musk of the Void. She tightened her grip on the Vorpal Relic, the cold stone pulsing with a faint, rhythmic thrum against her palm—a heartbeat that was not her own.">
                                                The wind <span class="style-suggestion" data-wrong="didn’t just"
                                                    data-right="did not merely"
                                                    data-reason="I think 'did not merely' adds much more atmospheric weight here than 'didn't just'. It sets the dark tone perfectly.">didn’t
                                                    just</span> howl
                                                across the plains; it whispered <span class="grammar-error"
                                                    data-wrong="names" data-right="the names"
                                                    data-reason="Missing a definite article here. 'The names' feels more grounded in the prose.">names</span>
                                                <span class="style-suggestion" data-wrong="ELENA" data-right="Elena"
                                                    data-reason="Let's keep the character names in standard casing for a cleaner look, unless they're shouting!">ELENA</span>
                                                had spent a
                                                decade trying to bury. It carried the scent of ozone and ancient
                                                parchment,
                                                the <span class="style-suggestion" data-wrong="distinctive"
                                                    data-right="unmistakable"
                                                    data-reason="Try 'unmistakable'—it's a bit sharper and conveys a sense of dread that 'distinctive' lacks.">distinctive</span>
                                                musk of the Void. She <span class="style-suggestion"
                                                    data-wrong="adjusted" data-right="tightened"
                                                    data-reason="Changing 'adjusted' to 'tightened' makes her reaction feel much more visceral and tense.">adjusted</span>
                                                her grip on the <span
                                                    class="bg-blue-50 dark:bg-blue-900/10 px-1 border-b border-blue-200 dark:border-blue-800">Vorpal
                                                    Relic</span>, the cold stone pulsing with a faint, rhythmic thrum
                                                against her palm—a heartbeat that <span class="grammar-error"
                                                    data-wrong="wasn't hers" data-right="was not her own"
                                                    data-reason="Formalizing this contraction gives the sentence a more haunting, deliberate rhythm.">wasn't
                                                    hers</span>.
                                            </p>

                                            <p
                                                data-goal="Ahead, the cathedral spires tore at the bruised sky like the rusted teeth of a dying giant. The architecture was shifting; her fingers brushed a glyph on the doorframe that had not been there a moment before. A strange flickering moved in the shadows, a darkness that seemed to draw breath.">
                                                Ahead, the <span class="style-suggestion"
                                                    data-wrong="spires of the cathedral" data-right="cathedral spires"
                                                    data-reason="'Cathedral spires' has a better punch to it. It keeps the focus on the scale of the structure.">spires
                                                    of the cathedral</span>
                                                tore at the bruised sky like the rusted teeth of a dying giant. The
                                                architecture was <span class="highlight-active">shifting</span>; her
                                                fingers
                                                <span class="style-suggestion" data-wrong="traced" data-right="brushed"
                                                    data-reason="'Brushed' is a more delicate verb. It makes the discovery of the glyph feel accidental and eerie.">traced</span>
                                                a glyph on the
                                                doorframe that <span class="grammar-error"
                                                    data-wrong="had'nt been there a moment ago"
                                                    data-right="had not been there a moment before"
                                                    data-reason="A couple of quick fixes here: correcting the contraction and smoothing out the timing for a better 'memory' feel.">had'nt
                                                    been there a
                                                    moment ago</span>. <span class="style-suggestion"
                                                    data-wrong="There was a strange flickering in the shadows"
                                                    data-right="A strange flickering moved in the shadows"
                                                    data-reason="Let's get the flickering moving! It makes the scene feel alive and much more threatening.">There
                                                    was a <span class="spelling-error" data-wrong="starnge"
                                                        data-right="strange"
                                                        data-reason="Just a quick typo here—happens to the best of us!">starnge</span>
                                                    flickering in the
                                                    shadows</span>, a darkness that seemed to <span
                                                    class="style-suggestion" data-wrong="breathe"
                                                    data-right="draw breath"
                                                    data-reason="'Draw breath' sounds more active and ominous than 'breathe' in this context.">breathe</span>.
                                            </p>

                                            <p
                                                data-goal="“It knows we're here, Leo,” Elena whispered. “It's rewriting the interior as we speak. We're not just walking into ruins; we're walking into a memory that does not want to be forgotten.”">
                                                “It knows we're here, <span
                                                    class="text-blue-500 font-medium font-bold">Leo</span>,” Elena
                                                whispered. “It's rewriting the interior as we speak. We're not just
                                                walking
                                                into ruins; we're walking into a memory that <span class="grammar-error"
                                                    data-wrong="doesn't" data-right="does not"
                                                    data-reason="I'd suggest expanding 'doesn't' to 'does not'—it keeps the dialogue feeling serious and weighty.">doesn't</span>
                                                want to be
                                                forgotten.”</p>

                                            <p
                                                data-goal="Leo did not answer at once. He was staring at the moss-covered steps. The stone here was ancient, older than the First Empire, yet it felt as though it were being watched by them. Every scrape of his boot rang through the hollow arches like a physical blow.">
                                                Leo <span class="grammar-error" data-wrong="didn't answer immediately"
                                                    data-right="did not answer at once"
                                                    data-reason="'Did not answer at once' feels a bit more natural for his character in this moment.">didn't
                                                    answer immediately</span>.
                                                He was staring at the <span class="spelling-error"
                                                    data-wrong="moss-coverred" data-right="moss-covered"
                                                    data-reason="Spelling check: 'covered' only needs one 'r' at the end.">moss-coverred</span>
                                                steps. The stone here was ancient, older than the First Empire, yet it
                                                felt
                                                <span class="style-suggestion"
                                                    data-wrong="as if it was being watched by them"
                                                    data-right="as though it were being watched by them"
                                                    data-reason="Using 'as though' and the subjunctive 'were' really amps up the gothic atmosphere here.">as
                                                    if it was being
                                                    watched by them</span>. Every scrape of his boot <span
                                                    class="style-suggestion" data-wrong="echoed" data-right="rang"
                                                    data-reason="'Rang' is such a cold, physical verb. It works well with the 'hollow arches' imagery.">echoed</span>
                                                through the
                                                hollow arches like a physical blow.
                                            </p>

                                            <p
                                                data-goal="The air thickened with the metallic tang of dried blood. Elena felt the Relic’s weight increasing. It was no longer merely lead and stone; it was the burden of a thousand lost souls, all of them screaming at once in the silence of her mind.">
                                                The air <span class="style-suggestion" data-wrong="grew thick"
                                                    data-right="thickened"
                                                    data-reason="Small tweak: 'thickened' is more direct and hits harder.">grew
                                                    thick</span> with the metallic tang of dried blood. Elena felt the
                                                <span class="grammar-error" data-wrong="Relics" data-right="Relic’s"
                                                    data-reason="Just needs an apostrophe here to show the Relic's weight.">Relics</span>
                                                weight
                                                increasing. It <span class="style-suggestion"
                                                    data-wrong="wasn't just lead and stone anymore"
                                                    data-right="was no longer merely lead and stone"
                                                    data-reason="This change makes the Relic's burden feel more ancient and heavy.">wasn't
                                                    just lead and stone
                                                    anymore</span>; it was the <span class="style-suggestion"
                                                    data-wrong="weight" data-right="burden"
                                                    data-reason="'Burden' has such a great thematic connection to those 'thousand lost souls'.">weight</span>
                                                of a thousand
                                                lost souls, <span class="style-suggestion" data-wrong="and theyr'e all"
                                                    data-right="all of them"
                                                    data-reason="Removing 'and they're all' and using 'all of them' instead focuses the ending on the souls themselves.">and
                                                    theyr'e all</span> screaming
                                                at once in the silence of her mind.
                                            </p>
                                            <p class="mt-8 text-gray-500 italic text-sm">
                                                The scent of <span
                                                    class="bg-red-100 dark:bg-red-900/30 border-b border-red-500 text-red-700 dark:text-red-400 px-0.5 cursor-help"
                                                    title="Plot Hole: Character is anosmic according to Chapter 2">ozone</span>
                                                became a physical weight.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- Closes flex-1 flex row wrapper (Line 797) -->

                            <!-- Timeline Navigation Bar -->
                            <div
                                class="h-10 border-t border-gray-100 dark:border-white/5 bg-gray-50/50 dark:bg-black/20 flex items-center px-6 gap-4 shrink-0 mt-auto">
                                <span class="material-icons-outlined text-[16px] text-gray-400">query_builder</span>
                                <div class="flex-1 h-1 bg-gray-200 dark:bg-gray-800 rounded-full relative">
                                    <div
                                        class="absolute inset-y-0 left-0 w-1/3 bg-blue-500/30 rounded-full border-r-2 border-blue-500">
                                    </div>
                                    <!-- Timeline Markers -->
                                    <div
                                        class="absolute left-[10%] top-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-gray-400 rounded-full">
                                    </div>
                                    <div
                                        class="absolute left-[33%] top-1/2 -translate-y-1/2 w-2 h-2 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.5)]">
                                    </div>
                                    <div
                                        class="absolute left-[60%] top-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-gray-400 rounded-full">
                                    </div>
                                </div>
                                <div class="text-[9px] font-bold text-gray-400 uppercase tracking-tighter">Chapter
                                    14 : The Voids Echo</div>
                            </div>
                        </div> <!-- Closes Main Editor column wrapper (Line 638) -->



                        <!-- Right Nav (AI & Intelligence Bar) -->
                        <div id="hero-right-sidebar"
                            class="w-12 bg-gray-50 dark:bg-black border-l border-gray-200 dark:border-white/5 flex flex-col items-center py-6 gap-8 shrink-0 lg:w-16 transition-all duration-500 z-40">
                            <!-- Tactical AI -->
                            <div class="group relative cursor-pointer" title="AI Assistant">
                                <span class="material-icons-outlined text-green-500 text-lg">history_edu</span>
                                <div
                                    class="absolute right-full mr-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    AI Assistant</div>
                            </div>
                            <!-- Editorial Insights -->
                            <div class="group relative cursor-pointer" title="Insights">
                                <span
                                    class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">insights</span>
                                <div
                                    class="absolute right-full mr-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    Editorial Insights</div>
                            </div>
                            <!-- Scene Analytics -->
                            <div class="group relative cursor-pointer" title="Analytics">
                                <span
                                    class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">equalizer</span>
                                <div
                                    class="absolute right-full mr-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    Scene Analytics</div>
                            </div>
                            <!-- Sticky Notes -->
                            <div class="group relative cursor-pointer" title="Comments">
                                <span
                                    class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">comment</span>
                                <div
                                    class="absolute right-full mr-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    Sticky Notes</div>
                            </div>
                            <!-- Timeline Anchors -->
                            <div class="group relative cursor-pointer" title="Timeline Anchors">
                                <span
                                    class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">anchor</span>
                                <div
                                    class="absolute right-full mr-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                    Timeline Anchors</div>
                            </div>

                            <div class="mt-auto flex flex-col items-center gap-6">
                                <div class="group relative cursor-pointer" title="Focus Mode">
                                    <span
                                        class="material-icons-outlined text-gray-400 group-hover:text-blue-500 transition-colors text-lg">fullscreen</span>
                                    <div
                                        class="absolute right-full mr-2 px-2 py-1 bg-gray-900 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap">
                                        Toggle Full-screen</div>
                                </div>
                                <span
                                    class="material-icons-outlined text-gray-300 text-lg cursor-pointer hover:text-gray-500 transition-colors">help_outline</span>
                            </div>
                        </div>
                        <!-- End Sidebar -->
                    </div> <!-- End Wrapper -->
                    <!-- Footer Bar -->
                    <div
                        class="h-10 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 flex items-center px-6 justify-between shrink-0">
                        <div class="flex items-center gap-6">
                            <div class="flex items-center gap-2">
                                <span class="material-icons-outlined text-[14px] text-gray-400">description</span>
                                <span class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">14,204
                                    Words</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="material-icons-outlined text-[14px] text-gray-400">schedule</span>
                                <span class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">42m
                                    Read</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <div
                                class="flex items-center gap-2 px-3 py-1 bg-gray-50 dark:bg-gray-800 rounded-full border border-gray-100 dark:border-gray-800">
                                <div class="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-tighter">Style
                                    Guide
                                    Active: DARK FANTASY PROSE</span>
                            </div>
                            <span class="material-icons-outlined text-gray-300 text-[18px]">more_horiz</span>
                        </div>
                    </div> <!-- End Main Editor -->
                </div> <!-- End Left Sidebar + Editor flex -->

                <!-- Formatting Bubble (Simulated) -->
                <div id="format-bubble" class="hidden absolute pointer-events-auto">
                    <div
                        class="bg-primary dark:bg-white text-white dark:text-primary px-3 py-1.5 rounded-lg shadow-xl flex items-center gap-4 animate-in zoom-in-95 duration-200">
                        <button class="hover:text-blue-400 transition-colors"><span
                                class="material-icons-outlined text-sm">format_bold</span></button>
                        <button class="hover:text-blue-400 transition-colors"><span
                                class="material-icons-outlined text-sm">format_italic</span></button>
                        <div class="h-4 w-[1px] bg-white/20 dark:bg-primary/20"></div>
                        <div class="flex items-center gap-2">
                            <button
                                class="text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded hover:bg-white/10"
                                onclick="simulateTextSize('small')">A</button>
                            <button
                                class="text-[12px] font-bold w-5 h-5 flex items-center justify-center rounded border border-white/20"
                                onclick="simulateTextSize('large')">A</button>
                        </div>
                        <div class="h-4 w-[1px] bg-white/20 dark:bg-primary/20"></div>
                        <button class="hover:text-blue-400 transition-colors"><span
                                class="material-icons-outlined text-sm">link</span></button>
                    </div>
                    <div class="w-2 h-2 bg-primary dark:bg-white rotate-45 mx-auto -mt-1 shadow-sm"></div>
                </div>

                <!-- Grammar Correction Popup (Penn Redesign) -->
                <div id="grammar-popup"
                    class="hidden absolute z-50 animate-in fade-in zoom-in-95 duration-300 pointer-events-auto">
                    <div
                        class="bg-white dark:bg-gray-900 rounded-[2rem] shadow-[0_30px_60px_rgba(0,0,0,0.12)] border border-gray-100 dark:border-gray-800 p-8 w-[320px] min-h-[320px] flex flex-col justify-between relative selection:bg-green-100">
                        <!-- Decorative Header -->
                        <div class="flex items-center justify-between mb-6">
                            <span
                                class="text-[11px] font-black text-green-600 dark:text-green-400 uppercase tracking-[0.2em]">Penn's
                                Note</span>
                            <button onclick="document.getElementById('grammar-popup').classList.add('hidden')"
                                class="w-6 h-6 flex items-center justify-center rounded-full hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                                <span class="material-icons-outlined text-[14px] text-gray-400">close</span>
                            </button>
                        </div>

                        <!-- Main Suggestion -->
                        <div class="mb-5">
                            <div
                                class="flex flex-col gap-3 p-4 bg-gray-50 dark:bg-gray-800/40 rounded-xl mb-4 border border-gray-100 dark:border-gray-800/60">
                                <span id="grammar-wrong" class="text-xs text-gray-400 line-through opacity-60"></span>
                                <div class="flex items-center gap-2">
                                    <span class="w-1 h-3 bg-green-500 rounded-full"></span>
                                    <span id="grammar-right"
                                        class="text-sm font-bold text-gray-900 dark:text-gray-100"></span>
                                </div>
                            </div>

                            <div id="grammar-reason"
                                class="text-[13px] text-gray-600 dark:text-gray-400 leading-relaxed font-serif italic pl-1 pr-2">
                            </div>
                        </div>

                        <!-- Options Section -->
                        <div class="space-y-4">
                            <!-- Full Rewrite Shortcut (Green Theme) -->
                            <div id="full-rewrite-option"
                                class="p-3 bg-green-50 dark:bg-green-900/10 rounded-xl border border-green-100 dark:border-green-800/30 group cursor-pointer transition-all hover:border-green-300">
                                <button id="rewrite-paragraph-btn" class="w-full text-left flex flex-col gap-1">
                                    <span
                                        class="text-[10px] text-green-600 dark:text-green-400 font-bold uppercase tracking-wider group-hover:underline">Ask
                                        Penn to rewrite</span>
                                    <span class="text-[10px] text-green-700/60 dark:text-green-400/60">Polish the
                                        entire
                                        section in one click</span>
                                </button>
                            </div>

                            <div class="flex gap-2">
                                <button onclick="document.getElementById('grammar-popup').classList.add('hidden')"
                                    class="flex-1 py-2.5 text-[10px] font-bold text-gray-400 uppercase hover:text-gray-600 dark:hover:text-gray-200 transition-colors tracking-widest bg-gray-50 dark:bg-gray-800 rounded-lg">Skip</button>
                                <button
                                    class="flex-1 py-2.5 bg-green-600 hover:bg-green-700 text-white text-[10px] font-bold uppercase tracking-widest rounded-lg shadow-lg shadow-green-500/20 transition-all hover:-translate-y-0.5"
                                    id="fix-btn-ui">Apply</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ghostwriter Rewrite Popup (Simulated) -->
                <div id="ghostwriter-ask-popup" class="hidden absolute pointer-events-auto">
                    <div
                        class="bg-primary dark:bg-white text-white dark:text-primary px-4 py-2 rounded-xl shadow-2xl flex items-center gap-3 whitespace-nowrap animate-in zoom-in-95 duration-200">
                        <span class="text-[11px] font-bold tracking-wide">Rewrite this for me?</span>
                        <div class="h-4 w-[1px] bg-white/20 dark:bg-primary/20"></div>
                        <button id="btn-accept-rewrite"
                            class="text-[11px] font-bold hover:text-blue-400 dark:hover:text-blue-600 transition-colors">Yes</button>
                        <button onclick="document.getElementById('ghostwriter-ask-popup').classList.add('hidden')"
                            class="text-[11px] font-bold opacity-50 hover:opacity-100 transition-opacity">No</button>
                    </div>
                    <!-- Bubble Arrow -->
                    <div class="w-2 h-2 bg-primary dark:bg-white rotate-45 mx-auto -mt-1 shadow-sm"></div>
                </div>

                <div
                    class="absolute -top-10 -left-10 w-40 h-40 bg-yellow-200/50 dark:bg-yellow-600/20 rounded-full blur-3xl -z-10">
                </div>
                <div
                    class="absolute -bottom-10 -right-10 w-60 h-60 bg-purple-200/50 dark:bg-purple-600/20 rounded-full blur-3xl -z-10">
                </div>
            </div>
        </div>
    </section>
    <section class="py-24 bg-white dark:bg-surface-dark relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="reveal slide-up text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-serif text-primary dark:text-white mb-4">From Spark to Manuscript
                </h2>
                <p class="text-gray-600 dark:text-gray-400 text-lg max-w-2xl mx-auto">A disciplined framework that
                    channels your creativity into coherent structures without imposing formulaic constraints.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Card 1 -->
                <div class="reveal slide-up delay-100 group relative">
                    <div
                        class="absolute -inset-0.5 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl opacity-0 group-hover:opacity-15 transition duration-500 blur-xl">
                    </div>
                    <div
                        class="relative bg-background-light dark:bg-background-dark p-8 rounded-2xl border border-gray-100 dark:border-gray-800 hover:border-yellow-200 dark:hover:border-yellow-900/50 transition-all duration-300 h-full">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white dark:bg-surface-dark flex items-center justify-center text-yellow-600 mb-6 shadow-sm group-hover:scale-110 group-hover:rotate-3 transition-transform duration-300">
                            <span class="material-icons-outlined text-3xl">lightbulb</span>
                        </div>
                        <h3 class="text-xl font-bold text-primary dark:text-white mb-3 tracking-tight">1. Ideation &
                            Cartography</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm leading-[1.4rem]">
                            Populate the Codex with the raw materials of your world. Architect multidimensional
                            character profiles and spatially arrange your narrative milestones on an interactive
                            timeline.
                        </p>
                    </div>
                </div>

                <!-- Card 2 -->
                <div class="reveal slide-up delay-200 group relative">
                    <div
                        class="absolute -inset-0.5 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl opacity-0 group-hover:opacity-15 transition duration-500 blur-xl">
                    </div>
                    <div
                        class="relative bg-background-light dark:bg-background-dark p-8 rounded-2xl border border-gray-100 dark:border-gray-800 hover:border-blue-200 dark:hover:border-blue-900/50 transition-all duration-300 h-full">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white dark:bg-surface-dark flex items-center justify-center text-blue-600 mb-6 shadow-sm group-hover:scale-110 group-hover:-rotate-3 transition-transform duration-300">
                            <span class="material-icons-outlined text-3xl">architecture</span>
                        </div>
                        <h3 class="text-xl font-bold text-primary dark:text-white mb-3 tracking-tight">2. Structural
                            Composition</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm leading-[1.4rem]">
                            Transmute your timeline into a cohesive sequence of beats. Our algorithmic pacing analysis
                            ensures narrative momentum and the satisfactory resolution of complex arcs.
                        </p>
                    </div>
                </div>

                <!-- Card 3 -->
                <div class="reveal slide-up delay-300 group relative">
                    <div
                        class="absolute -inset-0.5 bg-gradient-to-r from-green-400 to-emerald-500 rounded-2xl opacity-0 group-hover:opacity-15 transition duration-500 blur-xl">
                    </div>
                    <div
                        class="relative bg-background-light dark:bg-background-dark p-8 rounded-2xl border border-gray-100 dark:border-gray-800 hover:border-green-200 dark:hover:border-green-900/50 transition-all duration-300 h-full">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white dark:bg-surface-dark flex items-center justify-center text-green-600 mb-6 shadow-sm group-hover:scale-110 group-hover:rotate-3 transition-transform duration-300">
                            <span class="material-icons-outlined text-3xl">auto_stories</span>
                        </div>
                        <h3 class="text-xl font-bold text-primary dark:text-white mb-3 tracking-tight">3. Execution &
                            Refinement
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm leading-[1.4rem]">
                            Compose within a minimalist interface designed for flow state. Engage the Ghostwriter to
                            synthetically extrapolate sensory details or generate dialogue that adheres strictly to
                            established character voices.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="py-12 bg-white dark:bg-surface-dark">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid lg:grid-cols-2 gap-16 items-center">
                <!-- Left Column: Interactive Map Card -->
                <div
                    class="reveal slide-up bg-white dark:bg-surface-dark rounded-3xl p-6 shadow-2xl border border-gray-100 dark:border-gray-800 relative z-10">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="material-icons-outlined text-gray-400">account_tree</span>
                        <h3 class="text-sm font-bold uppercase tracking-widest text-gray-900 dark:text-white">
                            Relationship Map</h3>
                    </div>

                    <!-- Map Container (Nodes Centered) -->
                    <div
                        class="relative w-full h-[500px] bg-gray-50 dark:bg-gray-900/50 rounded-2xl border border-gray-100 dark:border-gray-800 overflow-hidden mb-6">

                        <!-- Connection Line: Agnes to Dora (Family - Purple) -->
                        <svg class="absolute pointer-events-none overflow-visible connection-line family-connection"
                            style="top: calc(47.5% - 6px); left: calc(50% - 156px); width: 130px; height: 60px; z-index: 5;">
                            <!-- Segment 1: Agnes side (Diagonal) -->
                            <path d="M 130 60 L 85 39" stroke="#9333EA" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Segment 2: Dora side -->
                            <path d="M 45 21 L 0 0" stroke="#9333EA" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Label Family -->
                            <text id="family-label-dora" x="65" y="30" text-anchor="middle" alignment-baseline="middle"
                                font-size="7" fill="black"
                                class="font-bold uppercase tracking-[0.2em] cursor-pointer hover:fill-purple-400 transition-colors pointer-events-auto"
                                transform="rotate(25, 65, 30)">
                                Family
                            </text>
                        </svg>

                        <!-- Dora Temple Hotspot Overlay -->
                        <div id="dora-hotspot"
                            class="map-hotspot character-node character-family absolute flex flex-col items-center gap-1 z-10"
                            style="top: calc(47.5% - 30px); left: calc(50% - 180px); " title="Click for Profile">
                            <div
                                class="w-12 h-12 rounded-full border-2 border-white/50 bg-accent dark:bg-yellow-900/40 flex items-center justify-center overflow-hidden shadow-lg relative">
                                <img src="{% static 'img/Dora-new.webp' %}" alt="Dora Temple Profile"
                                    class="w-full h-full object-cover object-top scale-[2.0] translate-y-[45%]">
                                <span
                                    class="absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping opacity-75"></span>
                            </div>
                            <span
                                class="bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-0.5 rounded-full font-medium whitespace-nowrap shadow-sm">Dora
                                Temple</span>
                        </div>

                        <!-- Agnes Temple Hotspot Overlay -->
                        <div id="agnes-hotspot"
                            class="map-hotspot absolute top-[calc(47.5%+30px)] left-[calc(50%-50px)] flex flex-col items-center gap-1 z-10"
                            title="Click for Profile">
                            <div
                                class="w-12 h-12 rounded-full border-2 border-white/50 bg-accent dark:bg-yellow-900/40 flex items-center justify-center overflow-hidden shadow-lg relative">
                                <img src="{% static 'img/Agnes.webp' %}" alt="Agnes Temple Profile"
                                    class="w-full h-full object-cover">
                                <span
                                    class="absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping opacity-75"></span>
                            </div>
                            <span
                                class="bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-0.5 rounded-full font-medium whitespace-nowrap shadow-sm">Agnes
                                Temple</span>
                        </div>

                        <!-- Connection Line: Agnes to Lucius -->
                        <svg class="absolute pointer-events-none overflow-visible connection-line mentor-connection"
                            style="top: calc(47.5%); left: calc(50% - 16px); width: 130px; height: 75px; z-index: 5;">
                            <!-- Straight Line Segment 1: Agnes side -->
                            <path d="M 0 54 L 60 28" stroke="#FACC15" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Straight Line Segment 2: Lucius side -->
                            <path d="M 90 15 L 123 0" stroke="#FACC15" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Label shifted further 'up' the line -->
                            <text id="mentor-label" x="75" y="21" text-anchor="middle" alignment-baseline="middle"
                                font-size="7" fill="black"
                                class="font-bold uppercase tracking-[0.2em] cursor-pointer hover:fill-blue-600 transition-colors pointer-events-auto"
                                transform="rotate(-24, 75, 21)">
                                Mentor
                            </text>
                        </svg>

                        <!-- Lucius Temple Hotspot Overlay -->
                        <div id="lucius-hotspot"
                            class="character-node character-mentor map-hotspot absolute flex flex-col items-center gap-1 z-10"
                            style="top: calc(47.5% - 30px); left: calc(50% + 80px);" title="Click for Profile">
                            <div
                                class="w-12 h-12 rounded-full border-2 border-white/50 bg-accent dark:bg-yellow-900/40 flex items-center justify-center overflow-hidden shadow-lg relative">
                                <img src="{% static 'img/Lucius-Temple.webp' %}" alt="Lucius Temple Profile"
                                    class="w-full h-full object-cover">
                                <span
                                    class="absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping opacity-75"></span>
                            </div>
                            <span
                                class="bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-0.5 rounded-full font-medium whitespace-nowrap shadow-sm">Lucius
                                Temple</span>
                        </div>

                        <!-- Connection Line: Agnes to Theodora (Friend) -->
                        <svg class="absolute pointer-events-none overflow-visible connection-line friend-connection"
                            style="top: calc(47.5% + 45px); left: calc(50% - 16px); width: 130px; height: 95px; z-index: 5;">
                            <!-- Segment 1: Agnes side (Corrected Diagonal) -->
                            <path d="M 0 15 L 50 42" stroke="#3B82F6" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Segment 2: Theodora side -->
                            <path d="M 80 58 L 120 80" stroke="#3B82F6" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Label Friend -->
                            <text id="friend-label" x="65" y="50" text-anchor="middle" alignment-baseline="middle"
                                font-size="7" fill="black"
                                class="font-bold uppercase tracking-[0.2em] cursor-pointer hover:fill-blue-400 transition-colors pointer-events-auto"
                                transform="rotate(28, 65, 50)">
                                Friend
                            </text>
                        </svg>

                        <!-- Aunt Theodora Hotspot Overlay -->
                        <div id="theodora-hotspot"
                            class="character-node character-friend map-hotspot absolute flex flex-col items-center gap-1 z-10"
                            style="top: calc(47.5% + 100px); left: calc(50% + 80px);" title="Click for Profile">
                            <div
                                class="w-12 h-12 rounded-full border-2 border-white/50 bg-accent dark:bg-yellow-900/40 flex items-center justify-center overflow-hidden shadow-lg relative">
                                <img src="{% static 'img/aunt-theodora.webp' %}" alt="Aunt Theodora Profile"
                                    class="w-full h-full object-cover object-top">
                                <span
                                    class="absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping opacity-75"></span>
                            </div>
                            <span
                                class="bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-0.5 rounded-full font-medium whitespace-nowrap shadow-sm">Aunt
                                Theodora</span>
                        </div>

                        <!-- Connection Line: Agnes to Elise (Family) -->
                        <svg class="absolute pointer-events-none overflow-visible connection-line family-connection"
                            style="top: calc(47.5% + 45px); left: calc(50% - 146px); width: 130px; height: 95px; z-index: 5;">
                            <!-- Straight Line Segment 1: Agnes side -->
                            <path d="M 130 0 L 85 28" stroke="#9333EA" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Straight Line Segment 2: Elise side -->
                            <path d="M 55 47 L 2 80" stroke="#9333EA" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Label Family -->
                            <text id="family-label" x="70" y="38" text-anchor="middle" alignment-baseline="middle"
                                font-size="7" fill="black"
                                class="font-bold uppercase tracking-[0.2em] cursor-pointer hover:fill-purple-400 transition-colors pointer-events-auto"
                                transform="rotate(-32, 70, 38)">
                                Family
                            </text>
                        </svg>

                        <!-- Elise Temple Hotspot Overlay -->
                        <div id="elise-hotspot"
                            class="character-node character-family map-hotspot absolute flex flex-col items-center gap-1 z-10"
                            style="top: calc(47.5% + 100px); left: calc(50% - 180px);" title="Click for Profile">
                            <div
                                class="w-12 h-12 rounded-full border-2 border-white/50 bg-accent dark:bg-yellow-900/40 flex items-center justify-center overflow-hidden shadow-lg relative">
                                <img src="{% static 'img/Elise-temple.webp' %}" alt="Elise Temple Profile"
                                    class="w-full h-full object-cover object-top">
                                <span
                                    class="absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping opacity-75"></span>
                            </div>
                            <span
                                class="bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-0.5 rounded-full font-medium whitespace-nowrap shadow-sm">Elise
                                Temple</span>
                        </div>

                        <!-- Connection Line: Agnes to Amy (Family) -->
                        <svg class="absolute pointer-events-none overflow-visible connection-line family-connection"
                            style="top: calc(47.5% + 48px); left: calc(50% - 22px); width: 22px; height: 122px; z-index: 5;">
                            <!-- Segment 1: Agnes side (Diagonal from Middle) -->
                            <path d="M 12 0 L 13.4 56" stroke="#9333EA" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Segment 2: Amy side -->
                            <path d="M 14.1 86 L 15 122" stroke="#9333EA" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Family Label centered on the line -->
                            <text id="family-label-amy" x="13.7" y="71" text-anchor="middle" alignment-baseline="middle"
                                font-size="7" fill="black"
                                class="font-bold uppercase tracking-[0.2em] cursor-pointer hover:fill-purple-400 transition-colors pointer-events-auto"
                                transform="rotate(89, 13.7, 71)">
                                Family
                            </text>
                        </svg>

                        <!-- Connection Line: Agnes to Mrs. Temple (Family) -->
                        <svg class="absolute pointer-events-none overflow-visible connection-line family-connection"
                            style="top: calc(47.5% - 87px); left: calc(50%); width: 22px; height: 122px; z-index: 5;">
                            <!-- Segment 1: Agnes side (Diagonal from Middle) -->
                            <path d="M 0 122 L 4 81" stroke="#9333EA" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Segment 2: Mrs. Temple side -->
                            <path d="M 8 41 L 12 0" stroke="#9333EA" stroke-width="3" fill="none" opacity="0.9" />
                            <!-- Family Label centered on the line -->
                            <text id="family-label-mrs" x="6" y="61" text-anchor="middle" alignment-baseline="middle"
                                font-size="7" fill="black"
                                class="font-bold uppercase tracking-[0.2em] cursor-pointer hover:fill-purple-400 transition-colors pointer-events-auto"
                                transform="rotate(-84, 6, 61)">
                                Family
                            </text>
                        </svg>

                        <!-- Amy Temple Hotspot Overlay -->
                        <div id="amy-hotspot"
                            class="character-node character-family map-hotspot absolute flex flex-col items-center gap-1 z-10"
                            style="top: calc(47.5% + 170px); left: calc(50% - 46px);" title="Click for Profile">
                            <div
                                class="w-12 h-12 rounded-full border-2 border-white/50 bg-accent dark:bg-purple-900/40 flex items-center justify-center overflow-hidden shadow-lg relative">
                                <img src="{% static 'img/Amy-temple.webp' %}" alt="Amy Temple Profile"
                                    class="w-full h-full object-cover object-top">
                                <span class="absolute -top-1 -right-1 w-2 h-2 bg-purple-400 rounded-full"></span>
                            </div>
                            <span
                                class="bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-0.5 rounded-full font-medium whitespace-nowrap shadow-sm">Amy
                                Temple</span>
                        </div>

                        <!-- Mrs. Temple Hotspot Overlay -->
                        <div id="mrs-hotspot"
                            class="character-node character-family map-hotspot absolute flex flex-col items-center gap-1 z-10"
                            style="top: calc(47.5% - 125px); left: calc(50% - 24px);" title="Click for Profile">
                            <div
                                class="w-12 h-12 rounded-full border-2 border-white/50 bg-accent dark:bg-red-900/40 flex items-center justify-center overflow-hidden shadow-lg relative">
                                <img src="{% static 'img/Mrs.Temple.webp' %}" alt="Mrs. Temple Profile"
                                    class="w-full h-full object-cover scale-[1.5] origin-top object-[70%_top]">
                                <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-400 rounded-full"></span>
                            </div>
                            <span
                                class="bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-0.5 rounded-full font-medium whitespace-nowrap shadow-sm">Mrs.
                                Temple</span>
                        </div>

                        <!-- Connection Key (Horizontal Header) -->
                        <div class="absolute top-4 left-1/2 -translate-x-1/2 z-20 pointer-events-none w-max">
                            <div
                                class="bg-white/90 dark:bg-surface-dark/90 backdrop-blur-md px-5 py-2 rounded-full border border-gray-200 dark:border-gray-800 shadow-lg pointer-events-auto flex items-center gap-6">
                                <div class="flex items-center gap-3 border-r border-gray-200 dark:border-gray-700 pr-4">
                                    <span class="material-icons-outlined text-xs text-gray-400">key</span>
                                    <h4 class="text-[9px] font-bold uppercase tracking-widest text-gray-400">
                                        Connection Key</h4>
                                </div>
                                <div class="flex items-center gap-6">
                                    <div id="legend-mentor"
                                        class="flex items-center gap-3 cursor-pointer hover:opacity-70 transition-all active:scale-95 group"
                                        data-type="mentor">
                                        <div
                                            class="w-4 h-0.5 bg-yellow-400 relative group-hover:scale-x-110 transition-transform">
                                            <div
                                                class="absolute right-0 -top-0.5 w-1.5 h-1.5 rounded-full bg-yellow-400">
                                            </div>
                                        </div>
                                        <span
                                            class="text-[9px] font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Mentor</span>
                                    </div>
                                    <div id="legend-friend"
                                        class="flex items-center gap-3 cursor-pointer hover:opacity-70 transition-all active:scale-95 group"
                                        data-type="friend">
                                        <div
                                            class="w-4 h-0.5 bg-blue-500 relative group-hover:scale-x-110 transition-transform">
                                            <div class="absolute right-0 -top-0.5 w-1.5 h-1.5 rounded-full bg-blue-500">
                                            </div>
                                        </div>
                                        <span
                                            class="text-[9px] font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Friend</span>
                                    </div>
                                    <div id="legend-family"
                                        class="flex items-center gap-3 cursor-pointer hover:opacity-70 transition-all active:scale-95 group"
                                        data-type="family">
                                        <div
                                            class="w-4 h-0.5 bg-purple-600 relative group-hover:scale-x-110 transition-transform">
                                            <div
                                                class="absolute right-0 -top-0.5 w-1.5 h-1.5 rounded-full bg-purple-600">
                                            </div>
                                        </div>
                                        <span
                                            class="text-[9px] font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Family</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Codex Panel -->
                <div id="codex-container"
                    class="reveal slide-up delay-200 relative h-[500px] bg-white dark:bg-surface-dark rounded-2xl border border-gray-100 dark:border-gray-800 shadow-xl overflow-hidden">

                    <!-- Default State: Marketing Text -->
                    <div id="codex-default" class="h-full overflow-y-auto p-8 custom-scrollbar">
                        <div
                            class="flex items-center gap-2 mb-4 text-xs font-bold text-blue-500 uppercase tracking-widest">
                            <span class="w-8 h-[1px] bg-blue-500"></span> Narrative Engineering
                        </div>
                        <h2 class="text-4xl md:text-[2.5rem] font-serif text-primary dark:text-white mb-6 font-bold">
                            The Architecture of Conflict</h2>
                        <p class="text-lg text-gray-600 dark:text-gray-400 leading-[1.4rem] mb-8">
                            A novel's complexity lies in the density of its relationships. This dynamic map evolves in
                            real-time with your manuscript, providing a living visualization of the shifting alliances
                            and deep-seated rivalries that drive your plot.
                        </p>
                        <div class="space-y-6">
                            <div class="flex gap-4">
                                <div
                                    class="flex-shrink-0 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center mt-0.5 shadow-sm">
                                    <span class="material-icons-outlined text-white text-sm">check</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900 dark:text-white mb-1">Neural Character Tracking
                                    </h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Characters are instantly
                                        indexed and positioned upon their narrative introduction, maintaining a perfect
                                        visual census of your cast.</p>
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <div
                                    class="flex-shrink-0 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center mt-0.5 shadow-sm">
                                    <span class="material-icons-outlined text-white text-sm">check</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900 dark:text-white mb-1">Conflict Topography</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Visualizes the emotional
                                        weight of every interaction, delineating the nuance between familial bonds,
                                        professional alliances, and bitter feuds.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dora Temple View -->
                    <div id="codex-dora" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="flex items-center gap-6 mb-8">
                            <div class="relative">
                                <div
                                    class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                                    <img src="{% static 'img/Dora-new.webp' %}" alt="Dora Temple"
                                        class="w-full h-full object-cover object-top scale-[2.0] translate-y-[45%]">
                                </div>
                            </div>
                            <div>
                                <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">Dora
                                    Temple</h4>
                                <div class="flex items-center gap-2">
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Cousin</span>
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest text-purple-500">Family</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="reveal slide-up active">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Psychological Profile</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                    Dora is the <span class="text-purple-500 font-bold">Shadow Observer</span>. She has
                                    spent her life being dismissed as 'just a cousin,' using that invisibility to gather
                                    a more complete picture of the family's corruption than even the patriarch. She is
                                    patient, calculating, and motivated by a quiet but fierce desire for justice.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                        Internal Conflict</h6>
                                    <p class="text-[11px] text-gray-500 italic">Vengeance vs. Virtue. She wants the
                                        Temples to fall, but fears that her methods are making her exactly like them.
                                    </p>
                                </div>
                                <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                        Hidden Thread</h6>
                                    <p class="text-[11px] text-gray-500 italic">Dora has a secret apartment in the Docks
                                        where she stores 'stolen' archive files for a rainy day.</p>
                                </div>
                            </div>

                            <div class="reveal slide-up active delay-100">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Relationship Pulse</h5>
                                <div class="space-y-4">
                                    <div
                                        class="group p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-purple-500/30 transition-all cursor-default">
                                        <div class="flex justify-between items-center mb-2">
                                            <div class="flex items-center gap-2">
                                                <div
                                                    class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden">
                                                    <img src="{% static 'img/Agnes.webp' %}"
                                                        class="w-full h-full object-cover">
                                                </div>
                                                <span class="text-sm font-bold text-primary dark:text-white">Agnes
                                                    Temple</span>
                                            </div>
                                            <span
                                                class="text-[8px] px-2 py-0.5 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 uppercase font-bold tracking-tighter">Hidden
                                                Ally</span>
                                        </div>
                                        <div
                                            class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                            <div class="bg-purple-500 h-full w-[85%]"></div>
                                        </div>
                                        <p class="text-[11px] text-gray-500 leading-snug">Dora provides the keys to the
                                            locks Agnes didn't know existed.</p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-2 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Narrative Pathing Insight</h5>
                                <div class="p-4 rounded-xl bg-purple-600 text-white dark:bg-purple-500 shadow-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="material-icons-outlined text-xs">auto_awesome</span>
                                        <span
                                            class="text-[9px] font-bold uppercase tracking-widest opacity-80">Ghostwriter
                                            Strategy</span>
                                    </div>
                                    <p class="text-[11px] leading-[1.4rem] mb-1 font-medium">Use Dora's technical
                                        knowledge of the 'Clock Tower' mechanism in Chapter 18.</p>
                                    <p class="text-[10px] opacity-70 italic">Strategy: She should be the one to give
                                        Agnes the first physical piece of evidence.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agnes Temple View -->
                    <div id="codex-agnes" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="flex items-center gap-6 mb-8">
                            <div class="relative">
                                <div
                                    class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                                    <img src="{% static 'img/Agnes.webp' %}" alt="Agnes Temple"
                                        class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div>
                                <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">Agnes
                                    Temple</h4>
                                <div class="flex items-center gap-2">
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Protagonist</span>
                                    <span class="text-[10px] font-bold uppercase tracking-widest text-blue-500">Book
                                        1</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="reveal slide-up active">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-800 pb-1">
                                    Psychological Profile</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                    Agnes is a <span class="text-primary dark:text-accent font-bold">Compulsive
                                        Investigator</span>. She treats human emotions as variables in an equation,
                                    hiding a latent, explosive empathy that she views as a professional weakness. To
                                    her, a mystery isn't just a job; it's the only way she knows how to process the
                                    world.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div
                                    class="p-4 rounded-xl bg-primary/5 dark:bg-white/5 border border-primary/10 dark:border-white/10">
                                    <h6
                                        class="text-[9px] font-bold uppercase tracking-widest text-primary dark:text-accent mb-2">
                                        Internal Conflict</h6>
                                    <p class="text-[11px] text-gray-500 italic">Logic vs. Blood Loyalty. She wants to be
                                        an objective observer, but her connection to the Temple name creates a primitive
                                        pull she hates.</p>
                                </div>
                                <div
                                    class="p-4 rounded-xl bg-primary/5 dark:bg-white/5 border border-primary/10 dark:border-white/10">
                                    <h6
                                        class="text-[9px] font-bold uppercase tracking-widest text-primary dark:text-accent mb-2">
                                        Narrative Thread</h6>
                                    <p class="text-[11px] text-gray-500 italic">Recurring nightmares about a 'White
                                        Room'—a repressed memory of her father's first trial.</p>
                                </div>
                            </div>

                            <div class="reveal slide-up active delay-100">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-800 pb-1">
                                    Relationship Pulse</h5>
                                <div class="space-y-4">
                                    <div
                                        class="group p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-accent dark:hover:border-yellow-900/30 transition-all cursor-default">
                                        <div class="flex justify-between items-center mb-2">
                                            <div class="flex items-center gap-2">
                                                <div
                                                    class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden">
                                                    <span
                                                        class="material-icons-outlined text-[14px] text-gray-400">person</span>
                                                </div>
                                                <span class="text-sm font-bold text-primary dark:text-white">Leo
                                                    Vance</span>
                                            </div>
                                            <span
                                                class="text-[8px] px-2 py-0.5 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 uppercase font-bold tracking-tighter">Complicated</span>
                                        </div>
                                        <div
                                            class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                            <div class="bg-orange-400 h-full w-[75%]"></div>
                                        </div>
                                        <p class="text-[11px] text-gray-500 leading-snug">Intellectual rivals since the
                                            London Academy. Leo keeps his discovery of the antidote secret from her.</p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-2 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    AI Contextual Insight</h5>
                                <div
                                    class="p-4 rounded-xl bg-primary text-white dark:bg-white dark:text-primary shadow-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="material-icons-outlined text-xs">auto_awesome</span>
                                        <span class="text-[9px] font-bold uppercase tracking-widest opacity-80">Advanced
                                            Narrative Analysis</span>
                                    </div>
                                    <p class="text-[11px] leading-[1.4rem] mb-2 font-medium">Agnes is reaching a
                                        "Breaking Point" event. In Chapter 14, her logic will fail her.</p>
                                    <p class="text-[10px] opacity-70 italic">Recommendation: Force a confrontation with
                                        The Curator to trigger her latent empathy.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lucius Temple View -->
                    <div id="codex-lucius" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="flex items-center gap-6 mb-8">
                            <div class="relative">
                                <div
                                    class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                                    <img src="{% static 'img/Lucius-Temple.webp' %}" alt="Lucius Temple"
                                        class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div>
                                <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">
                                    Lucius
                                    Temple</h4>
                                <div class="flex items-center gap-2">
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Antagonist
                                        / Patriarch</span>
                                    <span class="text-[10px] font-bold uppercase tracking-widest text-red-500">Book
                                        1</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="reveal slide-up active">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Psychological Profile</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                    Lucius is the <span class="text-red-500 font-bold">Stoic Architect</span>. He views
                                    the city's power structure as a clockwork mechanism that requires constant, often
                                    brutal, lubrication. His meticulous archiving isn't just a job—it's his way of
                                    controlling a world he finds inherently chaotic and untrustworthy.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 rounded-xl bg-red-500/5 border border-red-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-red-500 mb-2">
                                        Internal Conflict</h6>
                                    <p class="text-[11px] text-gray-500 italic">Preservation vs. Paternal Love. He loves
                                        Agnes by archiving her potential, yet fears her independence will break the
                                        system he built.</p>
                                </div>
                                <div class="p-4 rounded-xl bg-red-500/5 border border-red-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-red-500 mb-2">Hidden
                                        Thread</h6>
                                    <p class="text-[11px] text-gray-500 italic">Lucius keeps a 'Debt Ledger' of
                                        names—including current allies who would be destroyed if the archives ever
                                        leaked.</p>
                                </div>
                            </div>

                            <div class="reveal slide-up active delay-100">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Relationship Pulse</h5>
                                <div class="space-y-4">
                                    <div
                                        class="group p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-red-500/30 transition-all cursor-default">
                                        <div class="flex justify-between items-center mb-2">
                                            <div class="flex items-center gap-2">
                                                <div
                                                    class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden">
                                                    <img src="{% static 'img/Agnes.webp' %}"
                                                        class="w-full h-full object-cover">
                                                </div>
                                                <span class="text-sm font-bold text-primary dark:text-white">Agnes
                                                    Temple</span>
                                            </div>
                                            <span
                                                class="text-[8px] px-2 py-0.5 rounded-full bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 uppercase font-bold tracking-tighter">Strained
                                                Legacy</span>
                                        </div>
                                        <div
                                            class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                            <div class="bg-red-500 h-full w-[45%]"></div>
                                        </div>
                                        <p class="text-[11px] text-gray-500 leading-snug">He considers Agnes his
                                            greatest success and his most dangerous failure.</p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-2 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Antagonist Strategy Insight</h5>
                                <div class="p-4 rounded-xl bg-red-600 text-white dark:bg-red-500 shadow-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="material-icons-outlined text-xs">auto_awesome</span>
                                        <span
                                            class="text-[9px] font-bold uppercase tracking-widest opacity-80">Narrative
                                            Tension Analysis</span>
                                    </div>
                                    <p class="text-[11px] leading-[1.4rem] mb-2 font-medium">Lucius is preparing to
                                        "Sanitize" the archive in Chapter 20.</p>
                                    <p class="text-[10px] opacity-70 italic">Strategy: Use him to force the protagonist
                                        into a moral compromise to gain information.</p>
                                </div>
                            </div>
                        </div>
                    </div> <!-- Theodora Temple View -->
                    <div id="codex-theodora" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="flex items-center gap-6 mb-8">
                            <div class="relative">
                                <div
                                    class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                                    <img src="{% static 'img/aunt-theodora.webp' %}" alt="Aunt Theodora"
                                        class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div>
                                <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">
                                    Aunt
                                    Theodora</h4>
                                <div class="flex items-center gap-2">
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Confidante</span>
                                    <span class="text-[10px] font-bold uppercase tracking-widest text-blue-500">Book
                                        1</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="reveal slide-up active">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Psychological Profile</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                    Theodora is the <span class="text-blue-500 font-bold">Bohemian Rebel</span>. She
                                    uses her social status as a high-society ghost to mask her work within the
                                    resistance. Her radical ideologies are driven by the memory of a love lost during
                                    one of her brother’s early purges.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 rounded-xl bg-blue-500/5 border border-blue-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-blue-500 mb-2">
                                        Internal Conflict</h6>
                                    <p class="text-[11px] text-gray-500 italic">Safety vs. Subversion. She wants to
                                        protect Agnes but knows that true safety only comes through the system's
                                        dismantling.</p>
                                </div>
                                <div class="p-4 rounded-xl bg-blue-500/5 border border-blue-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-blue-500 mb-2">Hidden
                                        Thread</h6>
                                    <p class="text-[11px] text-gray-500 italic">Theodora communicates through floral
                                        semantics—arrangements delivered to 'neutral' addresses carry tactical meaning.
                                    </p>
                                </div>
                            </div>

                            <div class="reveal slide-up active delay-100">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Relationship Pulse</h5>
                                <div
                                    class="p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-blue-500/30 transition-all cursor-default">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="flex items-center gap-2">
                                            <div
                                                class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden">
                                                <img src="{% static 'img/Agnes.webp' %}"
                                                    class="w-full h-full object-cover">
                                            </div>
                                            <span class="text-sm font-bold text-primary dark:text-white">Agnes
                                                Temple</span>
                                        </div>
                                        <span
                                            class="text-[8px] px-2 py-0.5 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 uppercase font-bold tracking-tighter">Trusted</span>
                                    </div>
                                    <div
                                        class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                        <div class="bg-blue-400 h-full w-[90%]"></div>
                                    </div>
                                    <p class="text-[11px] text-gray-500 leading-snug">The only person Theodora is
                                        unwilling to use as a tactical asset.</p>
                                </div>
                            </div>

                            <div>
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-2 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Mentor Support Insight</h5>
                                <div class="p-4 rounded-xl bg-blue-500 text-white dark:bg-blue-600 shadow-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="material-icons-outlined text-xs">auto_awesome</span>
                                        <span
                                            class="text-[9px] font-bold uppercase tracking-widest opacity-80">Narrative
                                            Pathing Insight</span>
                                    </div>
                                    <p class="text-[11px] leading-[1.4rem] mb-1 font-medium">Use Theodora to bridge the
                                        gap between High London and the Docks.</p>
                                    <p class="text-[10px] opacity-70 italic">Strategy: Her dialogue should always
                                        contain double meanings for the reader to decipher.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Elise Temple View -->
                    <div id="codex-elise" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="flex items-center gap-6 mb-8">
                            <div class="relative">
                                <div
                                    class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                                    <img src="{% static 'img/Elise-temple.webp' %}" alt="Elise Temple"
                                        class="w-full h-full object-cover object-top">
                                </div>
                            </div>
                            <div>
                                <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">
                                    Elise
                                    Temple</h4>
                                <div class="flex items-center gap-2">
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Matriarch</span>
                                    <span class="text-[10px] font-bold uppercase tracking-widest text-purple-500">Book
                                        1</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="reveal slide-up active">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Psychological Profile</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                    Elise is the <span class="text-purple-500 font-bold">Wounded Guardian</span>. Her
                                    coldness is a calcified armor developed after witnessing the family's brutal rise.
                                    She believes that truth is a infection, and she has spent her life performing the
                                    'surgery' of silence to keep her loved ones uncontaminated.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                        Internal Conflict</h6>
                                    <p class="text-[11px] text-gray-500 italic">Duty vs. Guilt. She carries the weight
                                        of the family's 'necessary' disappearances so Agnes never has to know the cost
                                        of her luxury.</p>
                                </div>
                                <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                        Hidden Thread</h6>
                                    <p class="text-[11px] text-gray-500 italic">She secretly funds an underground asylum
                                        for former archive employees whose minds broke under the weight of the secrets.
                                    </p>
                                </div>
                            </div>

                            <div class="reveal slide-up active delay-100">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Relationship Pulse</h5>
                                <div
                                    class="p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-purple-500/30 transition-all cursor-default">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="flex items-center gap-2">
                                            <div
                                                class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden">
                                                <img src="{% static 'img/Agnes.webp' %}"
                                                    class="w-full h-full object-cover">
                                            </div>
                                            <span class="text-sm font-bold text-primary dark:text-white">Agnes
                                                Temple</span>
                                        </div>
                                        <span
                                            class="text-[8px] px-2 py-0.5 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 uppercase font-bold tracking-tighter">Frozen</span>
                                    </div>
                                    <div
                                        class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                        <div class="bg-purple-400 h-full w-[30%]"></div>
                                    </div>
                                    <p class="text-[11px] text-gray-500 leading-snug">Elise views Agnes's curiosity as a
                                        terminal illness.</p>
                                </div>
                            </div>

                            <div>
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-2 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Character Arc Insight</h5>
                                <div class="p-4 rounded-xl bg-purple-600 text-white dark:bg-purple-500 shadow-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="material-icons-outlined text-xs">auto_awesome</span>
                                        <span
                                            class="text-[9px] font-bold uppercase tracking-widest opacity-80">Ghostwriter
                                            Prediction</span>
                                    </div>
                                    <p class="text-[11px] leading-[1.4rem] mb-1 font-medium">Elise will sacrifice
                                        herself
                                        to destroy the Archive's core in the finale.</p>
                                    <p class="text-[10px] opacity-70 italic">Plot Beat: In Chapter 15, let her show a
                                        rare moment of tenderness that foreshadows her ultimate choice.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Amy Temple View -->
                    <div id="codex-amy" class="hidden h-full overflow-y-auto p-8 no-scrollbar">
                        <div class="flex items-center gap-6 mb-8">
                            <div class="relative">
                                <div
                                    class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                                    <img src="{% static 'img/Amy-temple.webp' %}" alt="Amy Temple"
                                        class="w-full h-full object-cover object-top">
                                </div>
                            </div>
                            <div>
                                <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">
                                    Amy Temple</h4>
                                <div class="flex items-center gap-2">
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Sister</span>
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest text-purple-500">Family</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="reveal slide-up active">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Psychological Profile</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                    Amy is the <span class="text-purple-400 font-bold">Strategic Socialite</span>.
                                    Behind her curated perfection is a sharp, analytical mind that understands social
                                    capital better than any algorithm. She feels underestimated by her family's
                                    intellectualism and uses that invisibility as a shield and a weapon.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 rounded-xl bg-purple-400/5 border border-purple-400/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-purple-400 mb-2">
                                        Internal Conflict</h6>
                                    <p class="text-[11px] text-gray-500 italic">Ambition vs. Belonging. She wants to
                                        lead the Temple dynasty but realizes the price is her own identity.</p>
                                </div>
                                <div class="p-4 rounded-xl bg-purple-400/5 border border-purple-400/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-purple-400 mb-2">
                                        Hidden Thread</h6>
                                    <p class="text-[11px] text-gray-500 italic">Amy is an expert in Victorian cyphers
                                        and has been intercepting Lucius's encrypted mail for months.</p>
                                </div>
                            </div>

                            <div>
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-2 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    AI Social Analysis</h5>
                                <div class="p-4 rounded-xl bg-purple-600 text-white dark:bg-purple-500 shadow-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="material-icons-outlined text-xs">auto_awesome</span>
                                        <span class="text-[9px] font-bold uppercase tracking-widest opacity-80">Social
                                            Plotting Insight</span>
                                    </div>
                                    <p class="text-[11px] leading-[1.4rem] mb-1 font-medium">Amy is being courted by the
                                        primary suspect.</p>
                                    <p class="text-[10px] opacity-70 italic">Plot Idea: Use Amy's chapters to gather
                                        intel on the elite's hidden circles.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mrs. Temple View -->
                    <div id="codex-mrs" class="hidden h-full overflow-y-auto p-8 no-scrollbar">
                        <div class="flex items-center gap-6 mb-8">
                            <div class="relative">
                                <div
                                    class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                                    <img src="{% static 'img/Mrs.Temple.webp' %}" alt="Mrs. Temple"
                                        class="w-full h-full object-cover scale-[1.5] origin-top object-[70%_top]">
                                </div>
                            </div>
                            <div>
                                <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">
                                    Mrs. Temple</h4>
                                <div class="flex items-center gap-2">
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Mother</span>
                                    <span
                                        class="text-[10px] font-bold uppercase tracking-widest text-red-500">Family</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="reveal slide-up active">
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    Psychological Profile</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                    Mrs. Temple is the <span class="text-red-500 font-bold">Fragile Oracle</span>. Her
                                    'fits' and 'nervous condition' are a subconscious defense mechanism—a way to channel
                                    the suffocating tension of a house built on crime. She sees the patterns of the
                                    family’s downfall long before anyone else.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 rounded-xl bg-red-500/5 border border-red-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-red-500 mb-2">
                                        Internal Conflict</h6>
                                    <p class="text-[11px] text-gray-500 italic">Knowledge vs. Sanity. The more she
                                        understands the family's past, the more she retreats into herself.</p>
                                </div>
                                <div class="p-4 rounded-xl bg-red-500/5 border border-red-500/10">
                                    <h6 class="text-[9px] font-bold uppercase tracking-widest text-red-500 mb-2">Hidden
                                        Thread</h6>
                                    <p class="text-[11px] text-gray-500 italic">She has a collection of pressed flowers
                                        from the 'forbidden gardens' where Lucius disposes of evidence.</p>
                                </div>
                            </div>

                            <div>
                                <h5
                                    class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-2 border-b border-gray-100 dark:border-gray-700 pb-1">
                                    AI Subtext Insight</h5>
                                <div class="p-4 rounded-xl bg-red-600 text-white dark:bg-red-500 shadow-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="material-icons-outlined text-xs">auto_awesome</span>
                                        <span class="text-[9px] font-bold uppercase tracking-widest opacity-80">Subtext
                                            Deep-Dive</span>
                                    </div>
                                    <p class="text-[11px] leading-[1.4rem] mb-1 font-medium">Mrs. Temple has a hidden
                                        correspondence with Aunt Theodora.</p>
                                    <p class="text-[10px] opacity-70 italic">Writing Tip: Her dialogue should be surreal
                                        but factually accurate regarding the mystery.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mentor View -->
                    <div id="codex-mentor" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="text-center mb-8">
                            <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Mentor</h4>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Beneath the surface of
                                the
                                Temple
                                Dynasty</p>
                            <div class="flex gap-2 justify-center">
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700 font-bold uppercase">Active</span>
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 font-bold uppercase">Public</span>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div
                                class="p-4 rounded-xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex -space-x-2">
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Lucius-Temple.webp' %}"
                                                class="w-full h-full object-cover">
                                        </div>
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Agnes.webp' %}" class="w-full h-full object-cover">
                                        </div>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Key
                                            Dynamic</span>
                                        <span class="text-[10px] text-primary dark:text-white font-medium">Lucius
                                            &
                                            Agnes</span>
                                    </div>
                                </div>
                                <h5 class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                    Narrative
                                    Arc</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 font-serif italic mb-2">
                                    "The
                                    transmission of logic from father to daughter is rarely a straight
                                    line."
                                </p>
                                <p class="text-xs text-gray-500 mb-4">Lucius provides Agnes with "unrestricted"
                                    data
                                    paths
                                    while maintaining a cold facade.</p>

                                <div class="space-y-4">
                                    <div>
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-yellow-500 mb-2 flex items-center gap-1">
                                            <span class="material-icons-outlined text-[10px]">auto_awesome</span> AI
                                            Insight
                                        </h6>
                                        <div
                                            class="p-3 rounded-xl bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-100 dark:border-yellow-800/30 text-[11px] text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                            Lucius acts as a gatekeeper of the past. Use their friction to reveal
                                            historical context without resorting to info-dumps.
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4 mt-6">
                                        <div class="p-4 rounded-xl bg-yellow-500/5 border border-yellow-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-yellow-500 mb-2">
                                                Cold Transmission</h6>
                                            <p class="text-[11px] text-gray-500 italic">Lucius provides Agnes with
                                                "unrestricted" data paths while maintaining a cold facade to toughen her
                                                for the truth.</p>
                                        </div>
                                        <div class="p-4 rounded-xl bg-yellow-500/5 border border-yellow-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-yellow-500 mb-2">
                                                Silent Expectation</h6>
                                            <p class="text-[11px] text-gray-500 italic">He expects her to deduce his
                                                involvement without him ever confessing it.</p>
                                        </div>
                                    </div>

                                    <div class="mt-6">
                                        <h6 class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                            Key Interactions</h6>
                                        <ul class="space-y-2">
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-yellow-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Residency
                                                    Cellar Handover (Ch. 12)</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-yellow-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Encrypted
                                                    Handshake Incident</span>
                                            </li>
                                        </ul>
                                    </div>

                                    <div>
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-yellow-500 mb-2 text-center py-2 bg-yellow-50/50 dark:bg-yellow-900/10 border border-yellow-100/50 dark:border-yellow-800/20 rounded-xl">
                                            Primary Conflict: Legacy vs. Independence</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Friend View -->
                    <div id="codex-friend" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="text-center mb-8">
                            <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Friendship
                            </h4>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">The silent anchor in
                                the
                                storm</p>
                            <div class="flex gap-2 justify-center">
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 font-bold uppercase">Trusted</span>
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-primary text-white font-bold uppercase">9/10
                                    Trust</span>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div
                                class="p-4 rounded-xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex -space-x-2">
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/aunt-theodora.webp' %}"
                                                class="w-full h-full object-cover">
                                        </div>
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Agnes.webp' %}" class="w-full h-full object-cover">
                                        </div>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Key
                                            Dynamic</span>
                                        <span class="text-[10px] text-primary dark:text-white font-medium">Theodora
                                            &
                                            Agnes</span>
                                    </div>
                                </div>
                                <h5 class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                    Narrative
                                    Arc</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 font-serif italic mb-2">
                                    "In a
                                    world
                                    built on dynasties, a chosen bond is the only true sovereignty."</p>
                                <p class="text-xs text-gray-500 mb-4">Aunt Theodora provides the unfiltered
                                    advice
                                    Agnes
                                    cannot find within Temple walls.</p>

                                <div class="space-y-4">
                                    <div>
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-blue-500 mb-2 flex items-center gap-1">
                                            <span class="material-icons-outlined text-[10px]">auto_awesome</span> AI
                                            Insight
                                        </h6>
                                        <div
                                            class="p-3 rounded-xl bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100/50 dark:border-blue-800/30 text-[11px] text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                            Theodora is the only person Agnes feels safe being vulnerable with. Use
                                            these scenes to process internal protagonist conflict.
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4 mt-6">
                                        <div class="p-4 rounded-xl bg-blue-500/5 border border-blue-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-blue-500 mb-2">
                                                Psychological Weight</h6>
                                            <p class="text-[11px] text-gray-500 italic">Theodora carries the 'unspoken'
                                                history of the family, acting as a living archive of what Lucius erased.
                                            </p>
                                        </div>
                                        <div class="p-4 rounded-xl bg-blue-500/5 border border-blue-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-blue-500 mb-2">
                                                The Chosen Bond</h6>
                                            <p class="text-[11px] text-gray-500 italic">Their connection is based on
                                                shared radicalism—Agnes sees in Dora the woman she might become if she
                                                leaves.</p>
                                        </div>
                                    </div>

                                    <div class="mt-6">
                                        <h6 class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                            Key Interactions</h6>
                                        <ul class="space-y-2">
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-blue-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The
                                                    Fringe-Society Introduction</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-blue-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The "Chosen
                                                    Bond" Discourse</span>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="mt-6">
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-blue-500 mb-2 text-center py-2 bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100/50 dark:border-blue-800/20 rounded-xl">
                                            Primary Conflict: Safety vs. Resistance</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Family View -->


                    <!-- Amy & Agnes Family View -->
                    <div id="codex-family-amy" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="text-center mb-8">
                            <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Family</h4>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Bound by blood, divided
                                by
                                secrets
                            </p>
                            <div class="flex gap-2 justify-center">
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 font-bold uppercase">Competitive</span>
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 font-bold uppercase">Rival</span>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div
                                class="p-4 rounded-xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex -space-x-2">
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Amy-temple.webp' %}"
                                                class="w-full h-full object-cover">
                                        </div>
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Agnes.webp' %}" class="w-full h-full object-cover">
                                        </div>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Key
                                            Dynamic</span>
                                        <span class="text-[10px] text-primary dark:text-white font-medium">Amy
                                            &
                                            Agnes</span>
                                    </div>
                                </div>
                                <h5 class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                    Narrative
                                    Arc</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 font-serif italic mb-2">
                                    "To
                                    shared parents, a shared prison."</p>
                                <p class="text-xs text-gray-500 mb-4">Amy's curated perfection is the shadow Agnes
                                    refuses to live in.</p>

                                <div class="space-y-4">
                                    <div>
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2 flex items-center gap-1">
                                            <span class="material-icons-outlined text-[10px]">auto_awesome</span> AI
                                            Insight
                                        </h6>
                                        <div
                                            class="p-3 rounded-xl bg-purple-50 dark:bg-purple-900/10 border border-purple-100 dark:border-purple-800/30 text-[11px] text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                            Amy's rivalry with Agnes hides a deep-seated fear of being 'the one left
                                            behind'
                                            if the family falls.
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4 mt-6">
                                        <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                                Rivalrous Depths</h6>
                                            <p class="text-[11px] text-gray-500 italic">Amy views Agnes's rebellion as a
                                                luxury she cannot afford, while Agnes sees Amy as a captive of the very
                                                system she hates.</p>
                                        </div>
                                        <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                                Social Leverage</h6>
                                            <p class="text-[11px] text-gray-500 italic">Amy is using her upcoming
                                                debutante ball to 'test' Agnes's loyalty to the Temple name by
                                                introducing a controversial contact.</p>
                                        </div>
                                    </div>

                                    <div class="mt-6">
                                        <h6 class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                            Key Interactions</h6>
                                        <ul class="space-y-2">
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-purple-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Charity
                                                    Gala Snub (Ch. 5)</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-purple-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Secret
                                                    Attic Meeting</span>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="mt-6">
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2 text-center py-2 bg-purple-50/50 dark:bg-purple-900/10 border border-purple-100/50 dark:border-purple-800/20 rounded-xl">
                                            Primary Conflict: Rivalry vs. Survival</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mrs. Temple & Agnes Family View -->
                    <div id="codex-family-mrs" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="text-center mb-8">
                            <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Family</h4>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Bound by blood, divided
                                by
                                secrets
                            </p>
                            <div class="flex gap-2 justify-center">
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 font-bold uppercase">Strained</span>
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-red-100 text-red-700 font-bold uppercase">Fraught</span>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div
                                class="p-4 rounded-xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex -space-x-2">
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Mrs.Temple.webp' %}"
                                                class="w-full h-full object-cover scale-[1.5] origin-top object-[70%_top]">
                                        </div>
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Agnes.webp' %}" class="w-full h-full object-cover">
                                        </div>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Key
                                            Dynamic</span>
                                        <span class="text-[10px] text-primary dark:text-white font-medium">Mrs. Temple
                                            &
                                            Agnes</span>
                                    </div>
                                </div>
                                <h5 class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                    Narrative
                                    Arc</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 font-serif italic mb-2">
                                    "The transmission of silence is the family's true legacy."</p>
                                <p class="text-xs text-gray-500 mb-4">Mrs. Temple's 'fragility' is the cage she uses to
                                    keep
                                    her daughters from the truth.</p>

                                <div class="space-y-4">
                                    <div>
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2 flex items-center gap-1">
                                            <span class="material-icons-outlined text-[10px]">auto_awesome</span> AI
                                            Insight
                                        </h6>
                                        <div
                                            class="p-3 rounded-xl bg-purple-50 dark:bg-purple-900/10 border border-purple-100 dark:border-purple-800/30 text-[11px] text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                            Mrs. Temple knows exactly what Agnes is searching for, but believes that
                                            partial
                                            knowledge is more dangerous than none.
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4 mt-6">
                                        <div class="p-4 rounded-xl bg-red-500/5 border border-red-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-red-500 mb-2">
                                                Maternal Silence</h6>
                                            <p class="text-[11px] text-gray-500 italic">Mrs. Temple's silence is the
                                                most powerful weapon in the house. Agnes can't tell if it's protection
                                                or complicity.</p>
                                        </div>
                                        <div class="p-4 rounded-xl bg-red-500/5 border border-red-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-red-500 mb-2">
                                                The Oracle's Debt</h6>
                                            <p class="text-[11px] text-gray-500 italic">She is slowly 'leaking'
                                                information to Agnes through the family ledgers she 'forgets' in the tea
                                                room.</p>
                                        </div>
                                    </div>

                                    <div class="mt-6">
                                        <h6 class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                            Key Interactions</h6>
                                        <ul class="space-y-2">
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-red-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Tea Room
                                                    Warning (Ch. 8)</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-red-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Locked
                                                    Jewelry Box Incident</span>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="mt-6">
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-red-500 mb-2 text-center py-2 bg-red-50/50 dark:bg-red-900/10 border border-red-100/50 dark:border-red-800/20 rounded-xl">
                                            Primary Conflict: Control vs. Autonomy</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dora & Agnes Family View -->
                    <div id="codex-family-dora" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="text-center mb-8">
                            <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Family</h4>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Bound by blood, divided
                                by
                                secrets
                            </p>
                            <div class="flex gap-2 justify-center">
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 font-bold uppercase">Rebellious</span>
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-green-100 text-green-700 font-bold uppercase">Ally</span>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div
                                class="p-4 rounded-xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex -space-x-2">
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Dora-new.webp' %}"
                                                class="w-full h-full object-cover">
                                        </div>
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Agnes.webp' %}" class="w-full h-full object-cover">
                                        </div>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Key
                                            Dynamic</span>
                                        <span class="text-[10px] text-primary dark:text-white font-medium">Dora
                                            &
                                            Agnes</span>
                                    </div>
                                </div>
                                <h5 class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                    Narrative
                                    Arc</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 font-serif italic mb-2">
                                    "The blood that rebels is the blood that remembers."</p>
                                <p class="text-xs text-gray-500 mb-4">Dora provides the map to the world outside the
                                    Temple
                                    dynasty.</p>

                                <div class="space-y-4">
                                    <div>
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2 flex items-center gap-1">
                                            <span class="material-icons-outlined text-[10px]">auto_awesome</span> AI
                                            Insight
                                        </h6>
                                        <div
                                            class="p-3 rounded-xl bg-purple-50 dark:bg-purple-900/10 border border-purple-100 dark:border-purple-800/30 text-[11px] text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                            Dora is testing Agnes. She won't bring her into the inner circle until she
                                            proves she can sacrifice her name.
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4 mt-6">
                                        <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                                Core Tension</h6>
                                            <p class="text-[11px] text-gray-500 italic">Inheritance vs. Insolence. Agnes
                                                sees Dora as a warning of what happens when a Temple goes rogue.</p>
                                        </div>
                                        <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                                Shared Secret</h6>
                                            <p class="text-[11px] text-gray-500 italic">They both know the real reason
                                                the East Wing was burned down in 1892.</p>
                                        </div>
                                    </div>

                                    <div class="mt-6">
                                        <h6 class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                            Key Interactions</h6>
                                        <ul class="space-y-2">
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-purple-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Clock
                                                    Tower Handover (Ch. 18)</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-purple-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The
                                                    Resistance Pledge</span>
                                        </ul>
                                    </div>

                                    <div class="mt-6">
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2 text-center py-2 bg-purple-50/50 dark:bg-purple-900/10 border border-purple-100/50 dark:border-purple-800/20 rounded-xl">
                                            Primary Conflict: Heritage vs. Rebellion</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="codex-family" class="hidden h-full overflow-y-auto p-8 custom-scrollbar">
                        <div class="text-center mb-8">
                            <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Family</h4>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Bound by blood, divided
                                by
                                secrets
                            </p>
                            <div class="flex gap-2 justify-center">
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 font-bold uppercase">Strained</span>
                                <span
                                    class="text-[9px] px-2 py-0.5 rounded-full bg-red-100 text-red-700 font-bold uppercase">Risk</span>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div
                                class="p-4 rounded-xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex -space-x-2">
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Elise-temple.webp' %}"
                                                class="w-full h-full object-cover">
                                        </div>
                                        <div
                                            class="w-8 h-8 rounded-full border-2 border-white dark:border-gray-800 overflow-hidden">
                                            <img src="{% static 'img/Agnes.webp' %}" class="w-full h-full object-cover">
                                        </div>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Key
                                            Dynamic</span>
                                        <span class="text-[10px] text-primary dark:text-white font-medium">Elise
                                            &
                                            Agnes</span>
                                    </div>
                                </div>
                                <h5 class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                    Narrative
                                    Arc</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 font-serif italic mb-2">
                                    "To
                                    protect
                                    the child, one must sometimes execute the innocence."</p>
                                <p class="text-xs text-gray-500 mb-4">Elise shield Agnes from the family's true
                                    nature, but
                                    the wall is becoming a prison.</p>

                                <div class="space-y-4">
                                    <div>
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2 flex items-center gap-1">
                                            <span class="material-icons-outlined text-[10px]">auto_awesome</span> AI
                                            Insight
                                        </h6>
                                        <div
                                            class="p-3 rounded-xl bg-purple-50 dark:bg-purple-900/10 border border-purple-100 dark:border-purple-800/30 text-[11px] text-gray-600 dark:text-gray-400 leading-[1.4rem]">
                                            The foundation of this relationship is "protective lies". Every character
                                            interaction here adds weight to the inevitable collapse.
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4 mt-6">
                                        <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                                The Golden Cage</h6>
                                            <p class="text-[11px] text-gray-500 italic">Elise believes she is saving
                                                Agnes
                                                by keeping her in the dark, but Agnes experiences this love as
                                                suffocation.
                                            </p>
                                        </div>
                                        <div class="p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                                            <h6
                                                class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2">
                                                Inherited Fear</h6>
                                            <p class="text-[11px] text-gray-500 italic">Elise sees her husband's
                                                recklessness in Agnes's eyes and is terrified history will repeat
                                                itself.
                                            </p>
                                        </div>
                                    </div>

                                    <div class="mt-6">
                                        <h6 class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-2">
                                            Key Interactions</h6>
                                        <ul class="space-y-2">
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-purple-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Garden
                                                    Silence (Ch. 3)</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="w-1 h-1 rounded-full bg-purple-400 mt-1.5 shrink-0"></span>
                                                <span class="text-[11px] text-gray-600 dark:text-gray-400">The Burning
                                                    Archive Encounter</span>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="mt-6">
                                        <h6
                                            class="text-[9px] font-bold uppercase tracking-widest text-purple-500 mb-2 text-center py-2 bg-purple-50/50 dark:bg-purple-900/10 border border-purple-100/50 dark:border-purple-800/20 rounded-xl">
                                            Primary Conflict: Protection vs. Truth</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </section>

    <!-- World-Building & Story Bible Section -->
    <section class="py-24 bg-gray-50 dark:bg-black overflow-hidden border-y border-gray-100 dark:border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row items-center gap-16">
                <!-- Left Content: Feature List -->
                <div class="reveal slide-up w-full md:w-1/2">
                    <div
                        class="flex items-center gap-2 mb-4 text-xs font-bold text-purple-500 uppercase tracking-widest">
                        <span class="w-8 h-[1px] bg-purple-500"></span> Story Organization
                    </div>
                    <h2
                        class="text-4xl md:text-[3.5rem] font-serif text-primary dark:text-white mb-6 font-bold leading-tight">
                        Intelligent
                        Story Bible</h2>
                    <p class="text-gray-600 dark:text-gray-400 text-lg mb-8 leading-relaxed">
                        Transition from chaos to a structured **shared universe**. The Codex is more than a wiki—it's
                        the
                        automated repository of your story's soul, tracking every thread so you never lose the path.
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                        <div class="flex flex-col gap-3">
                            <div
                                class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                                <span class="material-icons-outlined text-purple-500">menu_book</span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white">Centralized Wiki</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Deep-link characters, locations,
                                factions, and lore in a unified, searchable archive.</p>
                        </div>
                        <div class="flex flex-col gap-3">
                            <div
                                class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                                <span class="material-icons-outlined text-purple-500">grid_view</span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white">Appearance Heatmaps</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Automated tracking of entity mentions
                                across scenes with density visualization.</p>
                        </div>
                        <div class="flex flex-col gap-3">
                            <div
                                class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                                <span class="material-icons-outlined text-purple-500">hub</span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white">Reputation Systems</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Track dynamic faction shifts and
                                evolving character reputation across the series.</p>
                        </div>
                        <div class="flex flex-col gap-3">
                            <div
                                class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                                <span class="material-icons-outlined text-purple-500">layers</span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white">Series Support</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Scale from a single scene to a shared
                                universe with cross-book library synchronization.</p>
                        </div>
                    </div>

                    <div class="inline-flex items-center gap-2 text-purple-500 font-bold text-sm cursor-pointer group">
                        EXPLORE THE CODEX <span
                            class="material-icons-outlined transform group-hover:translate-x-1 transition-transform">arrow_forward</span>
                    </div>
                </div>

                <!-- Right Content: Codex Visualization Mockup -->
                <div class="reveal slide-left delay-200 w-full md:w-1/2 relative">
                    <div
                        class="bg-white dark:bg-surface-dark rounded-2xl border border-gray-100 dark:border-gray-800 shadow-2xl overflow-hidden min-h-[550px] flex flex-col">
                        <!-- Bible Header -->
                        <div
                            class="px-6 py-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between bg-gray-50/50 dark:bg-black/20">
                            <div class="flex items-center gap-4">
                                <div class="w-8 h-8 rounded bg-purple-500/10 flex items-center justify-center">
                                    <span class="material-icons-outlined text-purple-500 text-sm">auto_stories</span>
                                </div>
                                <div>
                                    <h5
                                        class="text-xs font-bold text-primary dark:text-white uppercase tracking-widest">
                                        The Codex</h5>
                                    <p class="text-[9px] text-gray-400 uppercase tracking-tighter">Universe: The Temple
                                        Dynasty</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div
                                    class="px-2 py-1 rounded bg-green-500/10 text-green-500 text-[8px] font-bold border border-green-500/20">
                                    SYNC:
                                    BOOK 1-3</div>
                                <span class="material-icons-outlined text-gray-400 text-sm">search</span>
                            </div>
                        </div>

                        <!-- Sidebar + Bible Content -->
                        <div class="flex flex-1 overflow-hidden">
                            <!-- Mini Navigation -->
                            <div
                                class="w-14 border-r border-gray-100 dark:border-gray-800 flex flex-col items-center py-6 gap-8 shrink-0 bg-gray-50/30 dark:bg-black/10">
                                <div class="relative group cursor-pointer">
                                    <span class="material-icons-outlined text-purple-500 text-lg">person_pin</span>
                                    <div
                                        class="absolute left-full ml-4 px-2 py-1 bg-gray-900 text-white text-[8px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">
                                        Characters</div>
                                </div>
                                <div class="relative group cursor-pointer">
                                    <span
                                        class="material-icons-outlined text-gray-300 text-lg hover:text-purple-400 transition-colors">place</span>
                                </div>
                                <div class="relative group cursor-pointer">
                                    <span
                                        class="material-icons-outlined text-gray-300 text-lg hover:text-purple-400 transition-colors">groups</span>
                                </div>
                                <div class="relative group cursor-pointer">
                                    <span
                                        class="material-icons-outlined text-gray-300 text-lg hover:text-purple-400 transition-colors">inventory_2</span>
                                </div>
                            </div>

                            <!-- Content Area -->
                            <div class="flex-1 p-8 overflow-y-auto custom-scrollbar">
                                <!-- Character Template Header -->
                                <div class="flex items-start justify-between mb-10">
                                    <div class="flex gap-5">
                                        <div
                                            class="w-20 h-20 rounded-2xl bg-purple-100 dark:bg-purple-900/30 overflow-hidden border border-purple-200 dark:border-purple-800/50 shadow-inner">
                                            <img src="{% static 'img/Agnes.webp' %}" class="w-full h-full object-cover">
                                        </div>
                                        <div class="pt-2">
                                            <h3
                                                class="text-2xl font-serif text-primary dark:text-white mb-2 leading-none">
                                                Agnes Temple
                                            </h3>
                                            <div class="flex gap-2">
                                                <span
                                                    class="text-[9px] px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-500 font-bold uppercase tracking-widest">Protagonist</span>
                                                <span
                                                    class="text-[9px] px-2 py-0.5 rounded-full bg-purple-500 text-white font-bold uppercase tracking-widest shadow-sm">Active</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right pt-2">
                                        <span
                                            class="text-[10px] font-bold text-gray-400 uppercase tracking-widest block mb-2">Reputation</span>
                                        <div class="flex gap-1.5 justify-end">
                                            <div
                                                class="w-5 h-1.5 bg-purple-500 rounded-full shadow-[0_0_8px_rgba(147,51,234,0.3)]">
                                            </div>
                                            <div
                                                class="w-5 h-1.5 bg-purple-500 rounded-full shadow-[0_0_8px_rgba(147,51,234,0.3)]">
                                            </div>
                                            <div
                                                class="w-5 h-1.5 bg-purple-500 rounded-full shadow-[0_0_8px_rgba(147,51,234,0.3)]">
                                            </div>
                                            <div class="w-5 h-1.5 bg-gray-200 dark:bg-gray-800 rounded-full"></div>
                                        </div>
                                        <p class="text-[8px] text-purple-500 font-bold mt-2 uppercase tracking-tighter">
                                            Rising: Chapter 14 Breakthrough</p>
                                    </div>
                                </div>

                                <!-- Heatmap Visualization Section -->
                                <div
                                    class="mb-10 p-5 bg-gray-50/50 dark:bg-black/20 rounded-2xl border border-gray-100 dark:border-gray-800">
                                    <h5
                                        class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-6 flex items-center gap-2">
                                        <span class="material-icons-outlined text-sm">grid_view</span> Appearance
                                        Density Heatmap
                                    </h5>
                                    <div class="flex gap-1.5 h-16 items-end">
                                        <!-- Mock chapters density -->
                                        <div class="flex-1 bg-purple-100 dark:bg-purple-900/20 rounded h-[20%] transition-all hover:h-[30%]"
                                            title="CH 1"></div>
                                        <div class="flex-1 bg-purple-300 dark:bg-purple-800/40 rounded h-[45%] transition-all hover:h-[55%]"
                                            title="CH 2"></div>
                                        <div class="flex-1 bg-purple-500 dark:bg-purple-700/60 rounded h-[80%] transition-all hover:h-[90%]"
                                            title="CH 3"></div>
                                        <div class="flex-1 bg-purple-600 dark:bg-purple-600/80 rounded h-[100%] transition-all hover:h-full"
                                            title="CH 4"></div>
                                        <div class="flex-1 bg-purple-200 dark:bg-purple-900/10 rounded h-[30%] transition-all hover:h-[40%]"
                                            title="CH 5"></div>
                                        <div class="flex-1 bg-purple-400 dark:bg-purple-800/30 rounded h-[60%] transition-all hover:h-[70%]"
                                            title="CH 6"></div>
                                        <div class="flex-1 bg-purple-700 rounded h-[90%] transition-all hover:scale-y-110 shadow-lg"
                                            title="CH 7"></div>
                                        <div class="flex-1 bg-purple-100 dark:bg-purple-900/10 rounded h-[15%]"
                                            title="CH 8"></div>
                                        <div class="flex-1 bg-purple-500 dark:bg-purple-700/60 rounded h-[75%]"
                                            title="CH 9"></div>
                                        <div class="flex-1 bg-purple-300 dark:bg-purple-800/40 rounded h-[40%]"
                                            title="CH 10"></div>
                                        <div class="flex-1 bg-purple-600 rounded h-[85%]" title="CH 11"></div>
                                        <div class="flex-1 bg-purple-200 rounded h-[25%]" title="CH 12"></div>
                                    </div>
                                    <div
                                        class="flex justify-between mt-4 text-[9px] text-gray-400 font-bold tracking-widest">
                                        <span>CH 1</span>
                                        <span class="opacity-50">NARRATIVE DENSITY BY CHAPTER</span>
                                        <span>CH 24</span>
                                    </div>
                                </div>

                                <!-- Custom Templates -->
                                <div class="grid grid-cols-2 gap-6">
                                    <div
                                        class="p-5 rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-surface-dark shadow-sm">
                                        <h6
                                            class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                                            <span class="material-icons-outlined text-sm">record_voice_over</span> Voice
                                            Sheet
                                        </h6>
                                        <div class="space-y-3">
                                            <div class="flex justify-between text-[11px] items-center">
                                                <span class="text-gray-500">Vocabulary</span>
                                                <span
                                                    class="text-primary dark:text-white font-bold px-2 py-0.5 bg-gray-50 dark:bg-gray-800 rounded">Academic</span>
                                            </div>
                                            <div class="flex justify-between text-[11px] items-center">
                                                <span class="text-gray-500">Punctuation</span>
                                                <span
                                                    class="text-primary dark:text-white font-bold px-2 py-0.5 bg-gray-50 dark:bg-gray-800 rounded">Meticulous</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div
                                        class="p-5 rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-surface-dark shadow-sm">
                                        <h6
                                            class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                                            <span class="material-icons-outlined text-sm">flag</span> Primary Goal
                                        </h6>
                                        <p class="text-[11px] text-gray-600 dark:text-gray-400 italic leading-relaxed">
                                            "To decouple my identity from the family's legacy without losing the people
                                            I love."</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Floating Notification (Series Support) -->
                        <div class="absolute bottom-6 right-6 animate-pulse-slow">
                            <div
                                class="bg-primary dark:bg-white text-white dark:text-primary px-5 py-2.5 rounded-full shadow-2xl text-[10px] font-bold flex items-center gap-2 border border-blue-400/20">
                                <span class="material-icons-outlined text-sm">cloud_sync</span>
                                SERIES UPDATE: CO-HERO SYNCED TO SHARED UNIVERSE
                            </div>
                        </div>
                    </div>

                    <!-- Decorative Background Elements -->
                    <div class="absolute -top-10 -right-10 w-64 h-64 bg-purple-500/5 rounded-full blur-3xl -z-10"></div>
                    <div class="absolute -bottom-10 -left-10 w-64 h-64 bg-blue-500/5 rounded-full blur-3xl -z-10"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Planning & Plotting Tools Section -->
    <section class="py-24 bg-white dark:bg-surface-dark overflow-hidden border-b border-gray-100 dark:border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row-reverse items-center gap-16">
                <!-- Right Content: Feature List -->
                <div class="reveal slide-up w-full md:w-1/2">
                    <div
                        class="flex items-center gap-2 mb-4 text-xs font-bold text-emerald-500 uppercase tracking-widest">
                        <span class="w-8 h-[1px] bg-emerald-500"></span> Architect Mode
                    </div>
                    <h2
                        class="text-4xl md:text-[3.5rem] font-serif text-primary dark:text-white mb-6 font-bold leading-tight">
                        Master Your Narrative</h2>
                    <p class="text-gray-600 dark:text-gray-400 text-lg mb-8 leading-relaxed">
                        Structure is the skeleton of great fiction. **Architect Mode** gives you the tools to map your
                        odyssey, from 3-act beats to complex multi-threaded timelines, with AI that knows your world's
                        laws.
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-10">
                        <div class="flex flex-col gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center">
                                <span class="material-icons-outlined text-emerald-500">account_tree</span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white">Multi-View Planning</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Seamlessly toggle between **Vertical
                                Outlines**, **Gantt Timelines**, and **Beat Sheets**.</p>
                        </div>
                        <div class="flex flex-col gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center">
                                <span class="material-icons-outlined text-emerald-500">psychology_alt</span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white">Brainstorming Assistant</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Feeling stuck? AI generates **plot
                                twists** and **consequences** based on existing character motives.</p>
                        </div>
                        <div class="flex flex-col gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center">
                                <span class="material-icons-outlined text-emerald-500">compare</span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white">Alternative Realities</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Store **multiple versions** of the same
                                scene. Experiment with 'What If?' pathways without losing your original draft.</p>
                        </div>
                        <div class="flex flex-col gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center">
                                <span class="material-icons-outlined text-emerald-500">speed</span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white">Pacing Analysis</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Visualize the **momentum** of your
                                story. Identify sluggish mid-sections before your readers do.</p>
                        </div>
                    </div>

                    <div class="inline-flex items-center gap-2 text-emerald-500 font-bold text-sm cursor-pointer group">
                        OPEN THE ARCHITECT <span
                            class="material-icons-outlined transform group-hover:translate-x-1 transition-transform">arrow_forward</span>
                    </div>
                </div>

                <!-- Left Content: Architect Mockup -->
                <div class="reveal slide-right delay-200 w-full md:w-1/2 relative">
                    <div
                        class="bg-white dark:bg-surface-dark rounded-2xl border border-gray-100 dark:border-gray-800 shadow-2xl overflow-hidden min-h-[550px] flex flex-col">

                        <!-- Planner Header -->
                        <div
                            class="px-6 py-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between bg-gray-50/50 dark:bg-black/20">
                            <div class="flex gap-4">
                                <div
                                    class="px-4 py-1.5 bg-emerald-500 text-white text-[10px] font-bold rounded-full shadow-lg shadow-emerald-500/20">
                                    BEAT SHEET</div>
                                <div
                                    class="px-4 py-1.5 text-gray-400 text-[10px] font-bold border border-transparent hover:border-gray-200 dark:hover:border-gray-700 rounded-full cursor-pointer transition-all">
                                    TIMELINE</div>
                                <div
                                    class="px-4 py-1.5 text-gray-400 text-[10px] font-bold border border-transparent hover:border-gray-200 dark:hover:border-gray-700 rounded-full cursor-pointer transition-all">
                                    OUTLINE</div>
                            </div>
                            <div class="flex gap-3">
                                <span
                                    class="material-icons-outlined text-gray-400 text-sm cursor-pointer hover:text-emerald-500 transition-colors">filter_list</span>
                                <span
                                    class="material-icons-outlined text-gray-400 text-sm cursor-pointer hover:text-emerald-500 transition-colors">settings</span>
                            </div>
                        </div>

                        <!-- Planner Content Container -->
                        <div class="flex-1 flex overflow-hidden">
                            <!-- Left: Beat List -->
                            <div
                                class="w-1/3 border-r border-gray-100 dark:border-gray-800 p-5 space-y-4 bg-gray-50/30 dark:bg-black/10">
                                <div
                                    class="p-4 bg-white dark:bg-gray-800 rounded-xl shadow-sm border-l-4 border-emerald-500 transform transition-transform hover:scale-105 cursor-pointer">
                                    <p class="text-[9px] font-bold text-emerald-500 uppercase tracking-widest">Act 1:
                                        Setup</p>
                                    <p class="text-[11px] font-bold text-primary dark:text-white mt-1 leading-tight">The
                                        Shattered Glass</p>
                                </div>
                                <div
                                    class="p-4 bg-white/50 dark:bg-gray-800/50 rounded-xl border border-dashed border-gray-200 dark:border-gray-700 opacity-60">
                                    <p class="text-[9px] font-bold text-blue-400 uppercase tracking-widest">Inciting
                                        Incident</p>
                                    <p class="text-[11px] font-bold text-primary dark:text-white mt-1 leading-tight">The
                                        Letter Arrives</p>
                                </div>
                                <div
                                    class="p-4 bg-white/50 dark:bg-gray-800/50 rounded-xl border border-dashed border-gray-200 dark:border-gray-700 opacity-40">
                                    <p class="text-[9px] font-bold text-gray-300 uppercase tracking-widest">Act 1:
                                        Climax</p>
                                    <p class="text-[11px] font-bold text-gray-400 mt-1 leading-tight">Leaving the City
                                    </p>
                                </div>
                            </div>

                            <!-- Right: Scene Details & Suggestions -->
                            <div class="flex-1 p-8 overflow-y-auto custom-scrollbar bg-white dark:bg-surface-dark">
                                <div class="mb-10">
                                    <div class="flex justify-between items-center mb-4">
                                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-[0.2em]">Scene 2:
                                            Alternative Pathways</h4>
                                        <div class="flex gap-2">
                                            <span
                                                class="px-2.5 py-1 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 text-[9px] font-bold rounded-full border border-emerald-200/50">V1
                                                (ACTIVE)</span>
                                            <span
                                                class="px-2.5 py-1 bg-gray-50 dark:bg-gray-800 text-gray-400 text-[9px] font-bold rounded-full border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-100 transition-colors">V2</span>
                                        </div>
                                    </div>
                                    <div
                                        class="p-5 bg-emerald-50/30 dark:bg-emerald-900/10 border border-emerald-100/50 dark:border-emerald-800/50 rounded-2xl relative group">
                                        <p class="text-[12px] text-gray-600 dark:text-gray-400 italic leading-relaxed">
                                            "Agnes finds the letter hidden in the clockwork mechanism. Instead of hiding
                                            it, she confronts her mother immediately, breaking the cycle of silence."
                                        </p>
                                        <span
                                            class="absolute top-2 right-2 material-icons-outlined text-xs text-emerald-400 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">edit</span>
                                    </div>
                                </div>

                                <!-- AI Suggestions Tool -->
                                <div class="mb-10">
                                    <div class="flex items-center gap-2 mb-4">
                                        <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                                        <h5
                                            class="text-[10px] font-bold text-emerald-500 uppercase tracking-[0.2em] leading-none">
                                            AI Braingstorming Assistant</h5>
                                    </div>
                                    <div class="space-y-3">
                                        <div
                                            class="p-5 bg-gray-900 dark:bg-black text-white rounded-2xl shadow-2xl border-l-[6px] border-emerald-500 relative overflow-hidden group">
                                            <div
                                                class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/10 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2">
                                            </div>
                                            <p
                                                class="text-[10px] text-emerald-400 font-bold mb-2 uppercase tracking-widest">
                                                What happens next?</p>
                                            <p class="text-[11px] leading-relaxed text-gray-300">Her mother's reaction
                                                triggers a house-wide search for the key, forcing Agnes to seek refuge
                                                in the forbidden East Wing. This accelerates the timeline by 2 chapters.
                                            </p>
                                            <div class="mt-4 flex gap-3">
                                                <button
                                                    class="text-[9px] bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-1.5 rounded-full font-bold transition-all active:scale-95">ADD
                                                    TO BEATS</button>
                                                <button
                                                    class="text-[9px] bg-gray-800 hover:bg-gray-700 text-gray-300 px-4 py-1.5 rounded-full font-bold border border-gray-700 transition-all active:scale-95">EXPLORE
                                                    VARIANCE</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pacing Graph -->
                                <div>
                                    <div class="flex items-center justify-between mb-4">
                                        <h5
                                            class="text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em] leading-none">
                                            Pacing & Momentum Analysis</h5>
                                        <div class="flex items-center gap-2">
                                            <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                                            <span
                                                class="text-[9px] text-emerald-500 font-bold uppercase tracking-wider">Optimal
                                                Flow</span>
                                        </div>
                                    </div>
                                    <div class="h-20 flex items-end gap-1.5 px-2">
                                        <!-- Mock chapters density -->
                                        <div
                                            class="flex-1 bg-gray-100 dark:bg-gray-800 rounded-t-sm h-[30%] transition-all hover:h-[40%] group relative">
                                            <div
                                                class="absolute bottom-full left-1/2 -translate-x-1/2 mb-1 opacity-0 group-hover:opacity-100 text-[8px] bg-gray-900 text-white px-1 rounded">
                                                Exp</div>
                                        </div>
                                        <div
                                            class="flex-1 bg-gray-100 dark:bg-gray-800 rounded-t-sm h-[50%] transition-all hover:h-[60%]">
                                        </div>
                                        <div
                                            class="flex-1 bg-emerald-400/60 rounded-t-sm h-[95%] shadow-[0_0_8px_rgba(52,211,153,0.2)]">
                                        </div>
                                        <div
                                            class="flex-1 bg-emerald-400/60 rounded-t-sm h-[80%] shadow-[0_0_8px_rgba(52,211,153,0.2)]">
                                        </div>
                                        <div class="flex-1 bg-gray-100 dark:bg-gray-800 rounded-t-sm h-[40%]"></div>
                                        <div class="flex-1 bg-gray-100 dark:bg-gray-800 rounded-t-sm h-[35%]"></div>
                                        <div
                                            class="flex-1 bg-emerald-500 rounded-t-sm h-[100%] shadow-[0_0_20px_rgba(16,185,129,0.4)]">
                                        </div>
                                        <div class="flex-1 bg-gray-100 dark:bg-gray-800 rounded-t-sm h-[45%]"></div>
                                        <div class="flex-1 bg-emerald-400/60 rounded-t-sm h-[70%]"></div>
                                        <div class="flex-1 bg-gray-100 dark:bg-gray-800 rounded-t-sm h-[20%]"></div>
                                    </div>
                                    <p
                                        class="text-[9px] text-gray-400 mt-4 text-center font-bold uppercase tracking-widest opacity-60">
                                        Narrative Momentum by Segment</p>
                                </div>
                            </div>
                        </div>

                        <!-- Footer / Status -->
                        <div
                            class="px-6 py-3 border-t border-gray-100 dark:border-gray-800 flex items-center justify-between bg-gray-50/30 dark:bg-black/20">
                            <div class="flex items-center gap-3">
                                <span class="material-icons-outlined text-xs text-emerald-500 animate-spin-slow">Don’t
                                    focus</span>
                                <span class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Architect:
                                    Live Suggestions Active</span>
                            </div>
                            <div class="text-[9px] text-gray-400 font-bold uppercase tracking-widest">Scenes: 24 ·
                                Variants: 12 · Pacing: Healthy</div>
                        </div>
                    </div>

                    <!-- Decorative Background Elements -->
                    <div class="absolute -top-10 -left-10 w-80 h-80 bg-emerald-500/5 rounded-full blur-3xl -z-10"></div>
                    <div class="absolute -bottom-10 -right-10 w-80 h-80 bg-teal-500/5 rounded-full blur-3xl -z-10">
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="py-24 bg-white dark:bg-surface-dark">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col-reverse md:flex-row items-center gap-16">
                <div class="reveal slide-up w-full md:w-1/2">
                    <div class="flex items-center gap-2 mb-4 text-xs font-bold text-blue-500 uppercase tracking-widest">
                        <span class="w-8 h-[1px] bg-blue-500"></span> Deep Focus
                    </div>
                    <h2 class="text-4xl md:text-5xl font-serif text-primary dark:text-white mb-6">Uncompromised
                        Immersion</h2>
                    <p class="text-gray-600 dark:text-gray-400 text-lg mb-8 leading-[1.4rem]">
                        The Minimalist Writing Pad eliminates cognitive load by removing superfluous interface elements.
                        Toggle <strong>Zen Mode</strong> for a full-screen focus with customizable typography—including
                        <strong>dyslexia-friendly fonts</strong> and precise <strong>spacing controls</strong>.
                    </p>
                    <div class="space-y-4 mb-8">
                        <div class="flex items-center gap-3">
                            <span class="material-icons-outlined text-blue-500 text-sm">check_circle</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400"><strong>Rich Text:</strong>
                                formatting tools for bold, italic, headings, quotes, and lists.</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="material-icons-outlined text-blue-500 text-sm">check_circle</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400"><strong>Split Panels:</strong> Pin
                                Manuscript and Chat side-by-side for seamless multi-view workflows.</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="material-icons-outlined text-blue-500 text-sm">check_circle</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400"><strong>Highlighter:</strong> Track
                                notes and plot holes with integrated timeline navigation.</span>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button id="zen-mode-btn"
                            class="bg-primary text-white dark:bg-white dark:text-primary px-6 py-2 rounded-lg text-sm font-medium">Zen
                            Mode</button>
                        <button id="theme-toggle-btn"
                            class="bg-transparent border border-gray-300 dark:border-gray-600 text-primary dark:text-white px-6 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">Dark/Light
                            Themes</button>
                    </div>
                </div>
                <div class="reveal slide-up delay-200 w-full md:w-1/2">
                    <div id="writing-pad-mockup"
                        class="bg-background-light dark:bg-background-dark rounded-xl p-4 shadow-lg border border-gray-100 dark:border-gray-700 transition-colors duration-500">
                        <div
                            class="bg-white dark:bg-surface-dark rounded-lg shadow-sm overflow-hidden h-96 flex flex-col">
                            <div class="flex-1 flex overflow-hidden">
                                <div
                                    class="flex-1 p-6 md:p-8 font-serif text-gray-800 dark:text-gray-200 text-sm md:text-base leading-[1.4rem] overflow-y-auto">
                                    <div class="flex items-center gap-2 mb-4 opacity-30">
                                        <div class="w-2 h-2 rounded-full bg-gray-400"></div>
                                        <div class="w-2 h-2 rounded-full bg-gray-400"></div>
                                    </div>
                                    <div
                                        class="text-xs text-gray-400 font-sans mb-4 text-center uppercase tracking-widest">
                                        Chapter 4: The Arrival</div>
                                    <p class="mb-4">The rain lashed against the cobblestones, turning the narrow streets
                                        of
                                        London into rivers of shadow. Holmes stood by the window, his silhouette cut
                                        sharply
                                        against the gaslight outside.</p>
                                    <p class="mb-4">"You see, Watson," he murmured, without turning around. "The absence
                                        of
                                        evidence is not the evidence of <span
                                            class="bg-red-100 dark:bg-red-900/30 border-b border-red-500 text-red-700 dark:text-red-400 px-0.5"
                                            title="Plot Hole: Watson mentioned evidence in Ch 2">absence</span>."</p>
                                </div>
                                <div id="mockup-sidebar"
                                    class="w-10 bg-orange-50/50 dark:bg-black/40 border-l border-orange-100 dark:border-white/5 flex flex-col items-center py-4 gap-6 shrink-0 transition-all duration-500">
                                    <span class="material-icons-outlined text-[16px] text-orange-400">psychology</span>
                                    <span class="material-icons-outlined text-[16px] text-gray-400">person</span>
                                    <span class="material-icons-outlined text-[16px] text-gray-400">push_pin</span>
                                    <div class="mt-auto mb-2">
                                        <span
                                            class="material-icons-outlined text-[16px] text-gray-300">help_outline</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Timeline Navigation bar -->
                            <div
                                class="h-8 border-t border-gray-100 dark:border-white/5 bg-gray-50/50 dark:bg-black/20 flex items-center px-4 gap-3 shrink-0">
                                <span class="material-icons-outlined text-[14px] text-gray-400">query_builder</span>
                                <div class="flex-1 h-0.5 bg-gray-200 dark:bg-gray-800 rounded-full relative">
                                    <div
                                        class="absolute inset-y-0 left-0 w-1/4 bg-blue-500/30 rounded-full border-r border-blue-500">
                                    </div>
                                    <div
                                        class="absolute left-[25%] top-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-red-500 rounded-full shadow-[0_0_6px_rgba(239,68,68,0.4)]">
                                    </div>
                                </div>
                                <div class="text-[8px] font-bold text-gray-400 uppercase tracking-tighter">Timeline
                                    Active</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Mentor Relationship Drawer -->
    <div id="mentor-drawer"
        class="fixed top-0 right-0 w-80 md:w-96 h-full bg-white dark:bg-surface-dark shadow-2xl transform translate-x-full transition-transform duration-500 z-[100] overflow-y-auto border-l border-gray-200 dark:border-border-dark selection:bg-accent/30">
        <div
            class="p-5 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center sticky top-0 bg-white/80 dark:bg-surface-dark/80 backdrop-blur-md z-10">
            <h3 class="font-bold text-sm uppercase tracking-widest text-gray-500 dark:text-gray-400">Relationship
                Insight
            </h3>
            <button id="close-mentor-drawer"
                class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-400">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>
        <div class="p-8">
            <!-- Overlapping Avatars -->
            <div class="flex justify-center items-center mb-8 h-20 relative">
                <div class="absolute left-1/2 -translate-x-12 z-10">
                    <img src="{% static 'img/Agnes.webp' %}" alt="Agnes"
                        class="w-16 h-16 rounded-full border-4 border-white dark:border-surface-dark shadow-lg object-cover">
                </div>
                <div class="absolute left-1/2 -translate-x-4 z-20">
                    <div
                        class="bg-accent text-primary text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm border border-white/50">
                        MENTOR
                    </div>
                </div>
                <div class="absolute left-1/2 translate-x-4 z-10">
                    <img src="{% static 'img/Lucius-Temple.webp' %}" alt="Lucius"
                        class="w-16 h-16 rounded-full border-4 border-white dark:border-surface-dark shadow-lg object-cover">
                </div>
            </div>

            <div class="text-center mb-10">
                <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Mentor</h4>
                <p class="text-xs text-gray-500 dark:text-gray-400">Beneath the surface of the Temple Dynasty</p>

                <div class="flex gap-2 justify-center mt-4">
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 border border-green-100 dark:border-green-800 font-bold uppercase">Active</span>
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800 font-bold uppercase">Publicly
                        Known</span>
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-primary text-white font-bold uppercase italic">8/10
                        Intensity</span>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Narrative Arc -->
                <div class="p-5 rounded-2xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-3 flex items-center gap-2">
                        <span class="material-icons-outlined text-xs">timeline</span> Narrative Arc
                    </h5>
                    <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem] font-serif italic">
                        "The transmission of logic from father to daughter is rarely a straight line; it is a series of
                        encrypted handshakes."
                    </p>
                    <p class="mt-3 text-xs text-gray-500 dark:text-gray-500 leading-[1.4rem]">
                        Lucius provides Agnes with the "unrestricted" data paths she needs for her investigation,
                        operating through encrypted shadows while maintaining a cold, formal patriarch facade.
                    </p>
                </div>

                <!-- Deep Intelligence -->
                <div class="space-y-3">
                    <div
                        class="p-3 rounded-xl bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100/50 dark:border-blue-800/30">
                        <h6
                            class="text-[9px] font-bold text-blue-600 dark:text-blue-400 uppercase tracking-tighter mb-1">
                            Shared Secret</h6>
                        <p class="text-[11px] text-gray-600 dark:text-gray-400 italic">"The true archives of Project
                            Gilded Cage remain hidden in the residency cellar."</p>
                    </div>

                    <div
                        class="p-3 rounded-xl bg-orange-50/50 dark:bg-orange-900/10 border border-orange-100/50 dark:border-orange-800/30">
                        <h6
                            class="text-[9px] font-bold text-orange-600 dark:text-orange-400 uppercase tracking-tighter mb-1">
                            Core Friction</h6>
                        <p class="text-[11px] text-gray-600 dark:text-gray-400">Lucius demands 'Structured' resolution
                            while Agnes pursues 'Unstructured' truth.</p>
                    </div>

                    <div
                        class="p-3 rounded-xl bg-red-50/50 dark:bg-red-900/10 border border-red-100/50 dark:border-red-800/30">
                        <h6 class="text-[9px] font-bold text-red-600 dark:text-red-400 uppercase tracking-tighter mb-1">
                            Mutual Vulnerability</h6>
                        <p class="text-[11px] text-gray-600 dark:text-gray-400">The Temple family reputation is tied to
                            the success of the case.</p>
                    </div>
                </div>

                <!-- Forecast -->
                <div class="p-5 rounded-2xl bg-primary text-white dark:bg-white dark:text-primary">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-icons-outlined text-sm">auto_awesome</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest opacity-70">AI Prediction</span>
                    </div>
                    <p class="text-xs leading-[1.4rem]">Their relationship is reaching a breaking point. One will soon
                        have to sacrifice their principles for the other's safety.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Friend Relationship Drawer -->
    <div id="friend-drawer"
        class="fixed top-0 right-0 w-80 md:w-96 h-full bg-white dark:bg-surface-dark shadow-2xl transform translate-x-full transition-transform duration-500 z-[100] overflow-y-auto border-l border-gray-200 dark:border-border-dark selection:bg-accent/30">
        <div
            class="p-5 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center sticky top-0 bg-white/80 dark:bg-surface-dark/80 backdrop-blur-md z-10">
            <h3 class="font-bold text-sm uppercase tracking-widest text-gray-500 dark:text-gray-400">Relationship
                Insight
            </h3>
            <button id="close-friend-drawer"
                class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-400">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>
        <div class="p-8">
            <!-- Overlapping Avatars -->
            <div class="flex justify-center items-center mb-8 h-20 relative">
                <div class="absolute left-1/2 -translate-x-12 z-10">
                    <img src="{% static 'img/Agnes.webp' %}" alt="Agnes"
                        class="w-16 h-16 rounded-full border-4 border-white dark:border-surface-dark shadow-lg object-cover">
                </div>
                <div class="absolute left-1/2 -translate-x-4 z-20">
                    <div
                        class="bg-blue-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm border border-white/50 uppercase tracking-tighter">
                        Friend
                    </div>
                </div>
                <div class="absolute left-1/2 translate-x-4 z-10">
                    <img src="{% static 'img/aunt-theodora.webp' %}" alt="Theodora"
                        class="w-16 h-16 rounded-full border-4 border-white dark:border-surface-dark shadow-lg object-cover">
                </div>
            </div>

            <div class="text-center mb-10">
                <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Friendship</h4>
                <p class="text-xs text-gray-500 dark:text-gray-400">The silent anchor in the storm</p>

                <div class="flex gap-2 justify-center mt-4">
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 border border-green-100 dark:border-green-800 font-bold uppercase">Active</span>
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800 font-bold uppercase">Trusted</span>
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-primary text-white font-bold uppercase italic">9/10
                        Trust</span>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Narrative Arc -->
                <div class="p-5 rounded-2xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-3 flex items-center gap-2">
                        <span class="material-icons-outlined text-xs">history_edu</span> Narrative Arc
                    </h5>
                    <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem] font-serif italic">
                        "In a world built on dynasties, a chosen bond is the only true sovereignty."
                    </p>
                    <p class="mt-3 text-xs text-gray-500 dark:text-gray-500 leading-[1.4rem]">
                        Aunt Theodora has been Agnes's confidante since the early London Academy days. She provides a
                        safe haven and unfiltered advice that Agnes cannot find within the Temple walls.
                    </p>
                </div>

                <!-- Deep Intelligence -->
                <div class="space-y-3">
                    <div
                        class="p-3 rounded-xl bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100/50 dark:border-blue-800/30">
                        <h6
                            class="text-[9px] font-bold text-blue-600 dark:text-blue-400 uppercase tracking-tighter mb-1">
                            Shared Secret</h6>
                        <p class="text-[11px] text-gray-600 dark:text-gray-400 italic">"They smuggled the first set of
                            Academy blueprints out together."</p>
                    </div>

                    <div
                        class="p-3 rounded-xl bg-purple-50/50 dark:bg-purple-900/10 border border-purple-100/50 dark:border-purple-800/30">
                        <h6
                            class="text-[9px] font-bold text-purple-600 dark:text-purple-400 uppercase tracking-tighter mb-1">
                            Mutual Support</h6>
                        <p class="text-[11px] text-gray-600 dark:text-gray-400">Theodora funds Agnes's independent
                            research through a series of shell foundations.</p>
                    </div>
                </div>

                <!-- Forecast -->
                <div class="p-5 rounded-2xl bg-blue-600 text-white mt-12">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-icons-outlined text-sm">auto_awesome</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest opacity-70">AI Prediction</span>
                    </div>
                    <p class="text-xs leading-[1.4rem]">Theodora will be called to testify against Lucius. Her loyalty
                        to
                        Agnes will be tested by the weight of the Temple influence.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Theodora Temple Insight Drawer -->
    <div id="theodora-drawer"
        class="fixed top-0 right-0 w-80 md:w-96 h-full bg-white dark:bg-surface-dark shadow-2xl transform translate-x-full transition-transform duration-500 z-[100] overflow-y-auto border-l border-gray-200 dark:border-border-dark selection:bg-accent/30">
        <!-- Header -->
        <div
            class="p-5 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center sticky top-0 bg-white/80 dark:bg-surface-dark/80 backdrop-blur-md z-10">
            <h3 class="font-bold text-sm uppercase tracking-widest text-gray-500 dark:text-gray-400">Codex: Character
                Insight</h3>
            <button id="close-theodora-drawer"
                class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-400">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>

        <!-- Content -->
        <div class="p-8">
            <div class="flex items-center gap-6 mb-10">
                <div class="relative">
                    <div
                        class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                        <img src="{% static 'img/aunt-theodora.webp' %}" alt="Theodora Temple Portrait"
                            class="w-full h-full object-cover">
                    </div>
                </div>
                <div>
                    <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">Aunt Theodora</h4>
                    <div class="flex items-center gap-2">
                        <span
                            class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Confidante</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest text-blue-500">Book 1</span>
                    </div>
                </div>
            </div>

            <div class="space-y-8">
                <div class="reveal slide-up active">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-800 pb-1">
                        Core Motivation</h5>
                    <p class="text-base text-gray-600 dark:text-gray-400 leading-[1.4rem] font-serif italic">
                        "Order is a cage. True friendship is the key we hide in plain sight."
                    </p>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                        Theodora operates on the fringes of High London society, using her social standing to protect
                        those who seek to dismantle the rigid structures of the status quo.
                    </p>
                </div>

                <div class="reveal slide-up active delay-100">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-800 pb-1">
                        Relationship Pulse</h5>
                    <div class="space-y-4">
                        <div
                            class="group p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-accent dark:hover:border-yellow-900/30 transition-all cursor-default">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded bg-gray-200 dark:bg-gray-700"></div>
                                    <span class="text-sm font-bold text-primary dark:text-white">Agnes Temple</span>
                                </div>
                                <span
                                    class="text-[8px] px-2 py-0.5 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 uppercase font-bold tracking-tighter">Unbreakable</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                <div class="bg-blue-400 h-full w-[95%]"></div>
                            </div>
                            <p class="text-[11px] text-gray-500 leading-snug">She sees herself in Agnes's fire. She will
                                risk her own standing to ensure Agnes has what she needs.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Family Relationship Drawer -->
    <div id="family-drawer"
        class="fixed top-0 right-0 w-80 md:w-96 h-full bg-white dark:bg-surface-dark shadow-2xl transform translate-x-full transition-transform duration-500 z-[100] overflow-y-auto border-l border-gray-200 dark:border-border-dark selection:bg-accent/30">
        <div
            class="p-5 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center sticky top-0 bg-white/80 dark:bg-surface-dark/80 backdrop-blur-md z-10">
            <h3 class="font-bold text-sm uppercase tracking-widest text-gray-500 dark:text-gray-400">Relationship
                Insight
            </h3>
            <button id="close-family-drawer"
                class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-400">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>
        <div class="p-8">
            <!-- Overlapping Avatars -->
            <div class="flex justify-center items-center mb-8 h-20 relative">
                <div class="absolute left-1/2 -translate-x-12 z-10">
                    <img src="{% static 'img/Agnes.webp' %}" alt="Agnes"
                        class="w-16 h-16 rounded-full border-4 border-white dark:border-surface-dark shadow-lg object-cover">
                </div>
                <div class="absolute left-1/2 -translate-x-4 z-20">
                    <div
                        class="bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm border border-white/50 uppercase tracking-tighter">
                        Family
                    </div>
                </div>
                <div class="absolute left-1/2 translate-x-4 z-10">
                    <img src="{% static 'img/Elise-temple.webp' %}" alt="Elise"
                        class="w-16 h-16 rounded-full border-4 border-white dark:border-surface-dark shadow-lg object-cover object-top">
                </div>
            </div>

            <div class="text-center mb-10">
                <h4 class="text-2xl font-serif text-primary dark:text-white mb-1">Mother & Daughter</h4>
                <p class="text-xs text-gray-500 dark:text-gray-400">Bound by blood, divided by secrets</p>

                <div class="flex gap-2 justify-center mt-4">
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 border border-green-100 dark:border-green-800 font-bold uppercase">Active</span>
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 border border-purple-100 dark:border-purple-800 font-bold uppercase">Strained</span>
                    <span
                        class="text-[9px] px-2 py-0.5 rounded-full bg-primary text-white font-bold uppercase italic">6/10
                        Trust</span>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Narrative Arc -->
                <div class="p-5 rounded-2xl bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-3 flex items-center gap-2">
                        <span class="material-icons-outlined text-xs">psychology</span> Narrative Arc
                    </h5>
                    <p class="text-sm text-gray-600 dark:text-gray-400 leading-[1.4rem] font-serif italic">
                        "To protect the child, one must sometimes execute the innocence."
                    </p>
                    <p class="mt-3 text-xs text-gray-500 dark:text-gray-500 leading-[1.4rem]">
                        Elise has spent decades building a fortress of lies around Agnes to shield her from the Temple
                        family's true nature. As Agnes digs deeper, this protective wall begins to feel like a prison.
                    </p>
                </div>

                <!-- Deep Intelligence -->
                <div class="space-y-3">
                    <div
                        class="p-3 rounded-xl bg-purple-50/50 dark:bg-purple-900/10 border border-purple-100/50 dark:border-purple-800/30">
                        <h6
                            class="text-[9px] font-bold text-purple-600 dark:text-purple-400 uppercase tracking-tighter mb-1">
                            Shared Burden</h6>
                        <p class="text-[11px] text-gray-600 dark:text-gray-400 italic">"The disappearance of Elias
                            Temple remains a forbidden topic at dinner."</p>
                    </div>

                    <div
                        class="p-3 rounded-xl bg-red-50/50 dark:bg-red-900/10 border border-red-100/50 dark:border-red-800/30">
                        <h6 class="text-[9px] font-bold text-red-600 dark:text-red-400 uppercase tracking-tighter mb-1">
                            Generational Trauma</h6>
                        <p class="text-[11px] text-gray-600 dark:text-gray-400">Elise fears Agnes is inheriting her
                            faster's "reckless curiosity."</p>
                    </div>
                </div>

                <!-- Forecast -->
                <div class="p-5 rounded-2xl bg-purple-600 text-white mt-12">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-icons-outlined text-sm">auto_awesome</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest opacity-70">AI Prediction</span>
                    </div>
                    <p class="text-xs leading-[1.4rem]">Elise will attempt to burn the archives before Agnes can access
                        them, triggering a final confrontation.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Elise Temple Insight Drawer -->
    <div id="elise-drawer"
        class="fixed top-0 right-0 w-80 md:w-96 h-full bg-white dark:bg-surface-dark shadow-2xl transform translate-x-full transition-transform duration-500 z-[100] overflow-y-auto border-l border-gray-200 dark:border-border-dark selection:bg-accent/30">
        <!-- Header -->
        <div
            class="p-5 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center sticky top-0 bg-white/80 dark:bg-surface-dark/80 backdrop-blur-md z-10">
            <h3 class="font-bold text-sm uppercase tracking-widest text-gray-500 dark:text-gray-400">Codex: Character
                Insight</h3>
            <button id="close-elise-drawer"
                class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-400">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>

        <!-- Content -->
        <div class="p-8">
            <div class="flex items-center gap-6 mb-10">
                <div class="relative">
                    <div
                        class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                        <img src="{% static 'img/Elise-temple.webp' %}" alt="Elise Temple Portrait"
                            class="w-full h-full object-cover object-top">
                    </div>
                </div>
                <div>
                    <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">Elise Temple</h4>
                    <div class="flex items-center gap-2">
                        <span
                            class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Matriarch</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest text-purple-500">Book 1</span>
                    </div>
                </div>
            </div>

            <div class="space-y-8">
                <div class="reveal slide-up active">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-800 pb-1">
                        Core Motivation</h5>
                    <p class="text-base text-gray-600 dark:text-gray-400 leading-[1.4rem] font-serif italic">
                        "The family name is not a gift; it is a fortress that must be defended."
                    </p>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                        Elise is the silent architect of the Temple family's public image. She sacrifices her own
                        happiness to ensure the family's survival, even if it means becoming the villain in her
                        daughter's story.
                    </p>
                </div>

                <div class="reveal slide-up active delay-100">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-800 pb-1">
                        Relationship Pulse</h5>
                    <div class="space-y-4">
                        <div
                            class="group p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-accent dark:hover:border-yellow-900/30 transition-all cursor-default">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded bg-gray-200 dark:bg-gray-700"></div>
                                    <span class="text-sm font-bold text-primary dark:text-white">Agnes Temple</span>
                                </div>
                                <span
                                    class="text-[8px] px-2 py-0.5 rounded-full bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 uppercase font-bold tracking-tighter">Fractured</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                <div class="bg-red-400 h-full w-[40%]"></div>
                            </div>
                            <p class="text-[11px] text-gray-500 leading-snug">Elise loves Agnes deeply, but Agnes views
                                Elise as an obstacle to the truth.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <section class="py-24 bg-background-light dark:bg-background-dark">
        <div class="reveal slide-up max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <span class="material-icons-outlined text-4xl text-yellow-500 mb-8 opacity-50">format_quote</span>
            <blockquote class="text-3xl md:text-4xl font-serif text-primary dark:text-white leading-tight mb-10">
                "Story Timeline Builder didn't just help me finish my trilogy; it helped me keep track of 40 characters
                across three generations without a single spreadsheet. It's indispensable."
            </blockquote>
            <div class="flex items-center justify-center gap-4">
                <img src="{% static 'img/Elena.webp' %}" alt="Elena R. Vance"
                    class="w-12 h-12 rounded-full object-cover shadow-sm bg-gray-100">
                <div class="text-left">
                    <div class="font-bold text-primary dark:text-white">Elena R. Vance</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">Bestselling Fantasy Author</div>
                </div>
            </div>
        </div>
    </section>
    <section class="py-24 bg-white dark:bg-surface-dark">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-5xl md:text-6xl font-serif text-primary dark:text-white mb-6">Ready to tell your story?</h2>
            <p class="text-xl text-gray-600 dark:text-gray-400 mb-10">Join 15,000+ writers who have found their flow.
            </p>
            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-6">
                <a class="bg-primary text-white dark:bg-white dark:text-primary px-8 py-4 rounded-full font-bold text-lg hover:opacity-90 transition-opacity shadow-md w-full sm:w-auto"
                    href="{% url 'login' %}">
                    Start Writing Now
                </a>
                <a class="bg-transparent border border-gray-300 dark:border-gray-600 text-primary dark:text-white px-8 py-4 rounded-full font-bold text-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors w-full sm:w-auto"
                    href="#">
                    View Pricing
                </a>
            </div>
            <p class="text-xs text-gray-400 dark:text-gray-500">No credit card required for 3-day trial.</p>
        </div>
    </section>
    <footer
        class="bg-background-light dark:bg-background-dark pt-20 pb-10 border-t border-gray-200 dark:border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8 mb-16">
                <div class="col-span-2 lg:col-span-2">
                    <div class="flex items-center mb-4">
                        <img src="{% static 'img/logo.webp' %}" alt="Story Timeline Builder"
                            style="height: 3.5rem; width: auto;">
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400 max-w-xs mb-6">
                        Architecting narrative worlds through a synthesis of structured planning, contextual
                        intelligence, and uncompromised creative flow.
                    </p>
                </div>
                <div>
                    <h4 class="font-bold text-primary dark:text-white mb-4">Product</h4>
                    <ul class="space-y-3 text-sm text-gray-600 dark:text-gray-400">
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Features</a></li>
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Pricing</a></li>
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Changelog</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-primary dark:text-white mb-4">Resources</h4>
                    <ul class="space-y-3 text-sm text-gray-600 dark:text-gray-400">
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Community</a></li>
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Help Center</a></li>
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Blog</a></li>
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Writers Guide</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-primary dark:text-white mb-4">Legal</h4>
                    <ul class="space-y-3 text-sm text-gray-600 dark:text-gray-400">
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Privacy Policy</a></li>
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Terms of Service</a></li>
                        <li><a class="hover:text-primary dark:hover:text-white" href="#">Cookie Policy</a></li>
                    </ul>
                </div>
            </div>
            <div
                class="border-t border-gray-200 dark:border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-sm text-gray-500 dark:text-gray-400">© 2026 Story Timeline Builder. All rights reserved.
                </p>
                <div class="flex gap-4 text-gray-400">
                    <a class="hover:text-primary dark:hover:text-white transition-colors" href="#"><span
                            class="material-icons-outlined">flutter_dash</span></a>
                    <a class="hover:text-primary dark:hover:text-white transition-colors" href="#"><span
                            class="material-icons-outlined">code</span></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Character Insight Drawer (Slides in from right) -->
    <div id="agnes-drawer"
        class="fixed top-0 right-0 w-80 md:w-96 h-full bg-white dark:bg-surface-dark shadow-2xl transform translate-x-full transition-transform duration-500 z-[100] overflow-y-auto border-l border-gray-200 dark:border-border-dark selection:bg-accent/30">
        <!-- Header -->
        <div
            class="p-5 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center sticky top-0 bg-white/80 dark:bg-surface-dark/80 backdrop-blur-md z-10">
            <h3 class="font-bold text-sm uppercase tracking-widest text-gray-500 dark:text-gray-400">Codex: Character
                Insight</h3>
            <button id="close-drawer"
                class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-400">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>

        <!-- Content -->
        <div class="p-8">
            <div class="flex items-center gap-6 mb-10">
                <div class="relative">
                    <div
                        class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                        <img src="{% static 'img/Agnes.webp' %}" alt="Agnes Temple Portrait"
                            class="w-full h-full object-cover">
                    </div>
                    <div
                        class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 border-4 border-white dark:border-surface-dark rounded-full">
                    </div>
                </div>
                <div>
                    <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">Agnes Temple</h4>
                    <div class="flex items-center gap-2">
                        <span
                            class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Protagonist</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest text-blue-500">Book 1</span>
                    </div>
                </div>
            </div>

            <div class="space-y-8">
                <div class="reveal slide-up active">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-800 pb-1">
                        Core Motivation</h5>
                    <p class="text-base text-gray-600 dark:text-gray-400 leading-[1.4rem] font-serif italic">
                        "I am not my father's legacy. I am the silence that follows his noise."
                    </p>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                        Agnes seeks to prove her intellectual independence from the Temple dynasty by solving the
                        'Gilded Cage' case using methods her father would deem 'unstructured.'
                    </p>
                </div>

                <div class="reveal slide-up active delay-100">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-800 pb-1">
                        Relationship Pulse</h5>
                    <div class="space-y-4">
                        <div
                            class="group p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-accent dark:hover:border-yellow-900/30 transition-all cursor-default">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded bg-gray-200 dark:bg-gray-700"></div>
                                    <span class="text-sm font-bold text-primary dark:text-white">Leo Vance</span>
                                </div>
                                <span
                                    class="text-[8px] px-2 py-0.5 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 uppercase font-bold tracking-tighter">Complicated</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                <div class="bg-orange-400 h-full w-[75%]"></div>
                            </div>
                            <p class="text-[11px] text-gray-500 leading-snug">Intellectual rivals since the London
                                Academy. Leo keeps his discovery of the antidote secret from her.</p>
                        </div>

                        <div
                            class="group p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-accent dark:hover:border-yellow-900/30 transition-all cursor-default">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded bg-gray-200 dark:bg-gray-700"></div>
                                    <span class="text-sm font-bold text-primary dark:text-white">The Curator</span>
                                </div>
                                <span
                                    class="text-[8px] px-2 py-0.5 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 uppercase font-bold tracking-tighter">Mentor</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                <div class="bg-blue-400 h-full w-[90%]"></div>
                            </div>
                            <p class="text-[11px] text-gray-500 leading-snug">The only person Agnes truly trusts. He
                                provides the contextual breadcrumbs that fuel her investigation.</p>
                        </div>
                    </div>
                </div>

                <div class="p-6 rounded-2xl bg-primary text-white dark:bg-white dark:text-primary mt-12">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-icons-outlined text-sm">auto_awesome</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest opacity-70">AI Ghostwriter
                            Prediction</span>
                    </div>
                    <p class="text-xs leading-[1.4rem]">Based on current beats, Agnes is likely to betray The Curator in
                        Chapter 14 to save Leo. This creates a major emotional pivot point.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Lucius Temple Insight Drawer -->
    <div id="lucius-drawer"
        class="fixed top-0 right-0 w-80 md:w-96 h-full bg-white dark:bg-surface-dark shadow-2xl transform translate-x-full transition-transform duration-500 z-[100] overflow-y-auto border-l border-gray-200 dark:border-border-dark selection:bg-accent/30">
        <!-- Header -->
        <div
            class="p-5 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center sticky top-0 bg-white/80 dark:bg-surface-dark/80 backdrop-blur-md z-10">
            <h3 class="font-bold text-sm uppercase tracking-widest text-gray-500 dark:text-gray-400">Codex: Character
                Insight</h3>
            <button id="close-lucius-drawer"
                class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-400">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>

        <!-- Content -->
        <div class="p-8">
            <div class="flex items-center gap-6 mb-10">
                <div class="relative">
                    <div
                        class="w-20 h-20 rounded-2xl bg-accent overflow-hidden shadow-sm rotate-3 border-4 border-white dark:border-gray-800">
                        <img src="{% static 'img/Lucius-Temple.webp' %}" alt="Lucius Temple Portrait"
                            class="w-full h-full object-cover">
                    </div>
                </div>
                <div>
                    <h4 class="text-2xl font-serif text-primary dark:text-white leading-none mb-2">Lucius Temple</h4>
                    <div class="flex items-center gap-2">
                        <span
                            class="text-[10px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-500">Antagonist
                            / Patriarch</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest text-red-500">Book 1</span>
                    </div>
                </div>
            </div>

            <div class="space-y-8">
                <div class="reveal slide-up active">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-3 border-b border-gray-100 dark:border-gray-800 pb-1">
                        Core Motivation</h5>
                    <p class="text-base text-gray-600 dark:text-gray-400 leading-[1.4rem] font-serif italic">
                        "The truth is not a luxury; it is a weapon. And I have spent my life forging it."
                    </p>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                        Lucius believes that order must be maintained at any cost. His meticulous archiving of the
                        city's secrets has made him both the most respected and the most feared man in London.
                    </p>
                </div>

                <div class="reveal slide-up active delay-100">
                    <h5
                        class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-400 mb-4 border-b border-gray-100 dark:border-gray-800 pb-1">
                        Relationship Pulse</h5>
                    <div class="space-y-4">
                        <div
                            class="group p-4 rounded-xl bg-background-light dark:bg-gray-800/50 border border-transparent hover:border-accent dark:hover:border-yellow-900/30 transition-all cursor-default">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded bg-gray-200 dark:bg-gray-700"></div>
                                    <span class="text-sm font-bold text-primary dark:text-white">Agnes Temple</span>
                                </div>
                                <span
                                    class="text-[8px] px-2 py-0.5 rounded-full bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 uppercase font-bold tracking-tighter">Strained</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden mb-2">
                                <div class="bg-red-400 h-full w-[40%]"></div>
                            </div>
                            <p class="text-[11px] text-gray-500 leading-snug">His daughter. He sees her rebellion as a
                                threat to the Temple legacy, yet secretly admires her intuition.</p>
                        </div>
                    </div>
                </div>

                <div class="p-6 rounded-2xl bg-primary text-white dark:bg-white dark:text-primary mt-12">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-icons-outlined text-sm">auto_awesome</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest opacity-70">AI Ghostwriter
                            Prediction</span>
                    </div>
                    <p class="text-xs leading-[1.4rem]">Lucius is likely to reveal the true nature of the 'Gilded Cage'
                        to Agnes in Chapter 22, forcing her to choose between truth and familial loyalty.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Intersection Observer for Reveal Animations
        document.addEventListener('DOMContentLoaded', () => {
            const observerOptions = {
                threshold: 0.15,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        // Optional: Unobserve after animating
                        // observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            const revealElements = document.querySelectorAll('.reveal');
            revealElements.forEach(el => observer.observe(el));

            // Nav Scroll Logic
            const nav = document.getElementById('main-nav');
            const handleScroll = () => {
                if (window.scrollY > 10) {
                    nav.classList.add('scrolled');
                } else {
                    nav.classList.remove('scrolled');
                }
            };
            window.addEventListener('scroll', handleScroll);
            handleScroll(); // Initial check

            // Theme Toggle Demo Logic
            const themeBtn = document.getElementById('theme-toggle-btn');
            const zenBtn = document.getElementById('zen-mode-btn');
            const mockup = document.getElementById('writing-pad-mockup');
            const sidebar = document.getElementById('mockup-sidebar');

            if (themeBtn && mockup) {
                themeBtn.addEventListener('click', () => {
                    mockup.classList.toggle('dark');
                });
            }

            // Hero Mockup Theme Toggle
            const heroThemeToggle = document.getElementById('hero-theme-toggle');
            const heroMockup = document.getElementById('hero-writing-mockup');

            if (heroThemeToggle && heroMockup) {
                heroThemeToggle.addEventListener('click', () => {
                    const isDark = heroMockup.classList.toggle('dark');
                    const icon = heroThemeToggle.querySelector('.material-icons-outlined');
                    if (icon) {
                        icon.textContent = isDark ? 'light_mode' : 'dark_mode';
                    }
                });
            }

            // Hero Mockup Zen Toggle
            const heroZenToggle = document.getElementById('hero-zen-toggle');
            const heroLeftSidebar = document.getElementById('hero-left-sidebar');
            const heroRightSidebar = document.getElementById('hero-right-sidebar');

            if (heroZenToggle && heroMockup) {
                heroZenToggle.addEventListener('click', () => {
                    const isZen = heroMockup.classList.toggle('hero-zen-active');
                    const icon = heroZenToggle.querySelector('.material-icons-outlined');
                    if (icon) {
                        icon.classList.toggle('text-blue-500', isZen);
                    }

                    // Hide popups when entering Zen mode
                    if (isZen) {
                        const askPopup = document.getElementById('ghostwriter-ask-popup');
                        const formatBubble = document.getElementById('format-bubble');
                        const writingPill = document.getElementById('writing-pill');
                        if (askPopup) askPopup.classList.add('hidden');
                        if (formatBubble) formatBubble.classList.add('hidden');
                        // Pill is handled via CSS opacity for smooth transition,
                        // but we can ensure it's hidden if needed
                    }
                });
            }

            if (zenBtn && mockup) {
                zenBtn.addEventListener('click', () => {
                    mockup.classList.toggle('zen-mode-active');
                });
            }

            // --- sequential Walkthrough Logic (Penn) ---
            const grammarPopup = document.getElementById('grammar-popup');
            const grammarWrong = document.getElementById('grammar-wrong');
            const grammarRight = document.getElementById('grammar-right');
            const grammarReason = document.getElementById('grammar-reason');
            const rewriteParaBtn = document.getElementById('rewrite-paragraph-btn');
            const fullRewriteOption = document.getElementById('full-rewrite-option');
            const fixBtnUi = document.getElementById('fix-btn-ui');
            let currentErrorElement = null;

            // Initialize walkthrough
            const allErrors = document.querySelectorAll('.grammar-error, .spelling-error, .style-suggestion');
            allErrors.forEach((el, index) => {
                if (index > 0) el.classList.add('walkthrough-inactive');
            });

            function showGrammarPopup(el, isRewrite = false) {
                if (el.classList.contains('walkthrough-inactive') && !isRewrite) return;

                currentErrorElement = el;

                if (isRewrite) {
                    grammarWrong.innerText = "Draft Phase";
                    grammarRight.innerText = "Penn's Revision";
                    grammarReason.innerHTML = `"I've smoothed out the rest of this paragraph to match the tone we've established. Shall we move on?"`;
                    if (fullRewriteOption) fullRewriteOption.classList.add('hidden');
                } else {
                    grammarWrong.innerText = el.getAttribute('data-wrong');
                    grammarRight.innerText = el.getAttribute('data-right');
                    grammarReason.innerHTML = `"${el.getAttribute('data-reason')}"`;
                    if (fullRewriteOption) fullRewriteOption.classList.remove('hidden');
                }

                const rect = el.getBoundingClientRect();
                const parentRect = heroMockup.getBoundingClientRect();

                // Show temporarily to get height
                grammarPopup.classList.remove('hidden');
                const popupHeight = grammarPopup.offsetHeight;

                grammarPopup.style.left = `${rect.left - parentRect.left + (rect.width / 2) - 160}px`;
                grammarPopup.style.top = `${rect.top - parentRect.top - popupHeight - 20}px`;
            }

            allErrors.forEach(el => {
                el.addEventListener('mouseenter', () => showGrammarPopup(el));
            });

            window.addEventListener('resize', () => grammarPopup.classList.add('hidden'));

            window.applyFullParagraphRewrite = function (para) {
                if (!para) return;
                const goalText = para.getAttribute('data-goal');
                if (!goalText) return;

                para.innerHTML = goalText;
                para.classList.add('text-green-600', 'dark:text-green-400', 'transition-all', 'duration-700');
                grammarPopup.classList.add('hidden');

                setTimeout(() => {
                    para.classList.remove('text-green-600', 'dark:text-green-400');
                    unlockNextInCategory(para);
                }, 1000);
            };

            window.applyCorrection = function () {
                if (currentErrorElement) {
                    const parentPara = currentErrorElement.closest('p');

                    if (currentErrorElement.id === 'penn-rewrite-trigger') {
                        applyFullParagraphRewrite(parentPara);
                        return;
                    }

                    const right = currentErrorElement.getAttribute('data-right');
                    currentErrorElement.innerText = right;
                    currentErrorElement.classList.remove('grammar-error', 'spelling-error', 'style-suggestion');
                    currentErrorElement.classList.add('text-green-600', 'dark:text-green-400', 'font-medium', 'transition-all', 'duration-700');

                    const fixedEl = currentErrorElement;
                    grammarPopup.classList.add('hidden');

                    // Find next error in sequence
                    let foundCurrent = false;
                    let nextError = null;
                    allErrors.forEach(el => {
                        if (el === fixedEl) {
                            foundCurrent = true;
                        } else if (foundCurrent && !nextError && el.classList.contains('walkthrough-inactive')) {
                            nextError = el;
                        }
                    });

                    if (nextError) {
                        setTimeout(() => {
                            nextError.classList.remove('walkthrough-inactive');
                            // Optional: auto-scroll to next error?
                        }, 800);
                    }

                    setTimeout(() => {
                        fixedEl.classList.remove('text-green-600', 'dark:text-green-400');
                        checkParagraphStatus(parentPara, fixedEl);
                    }, 1000);
                }
            };

            function checkParagraphStatus(para, lastFixedEl) {
                const remainingErrorsInPara = para.querySelectorAll('.grammar-error, .spelling-error, .style-suggestion');
                const hasPendingInactive = Array.from(remainingErrorsInPara).some(el => el.classList.contains('walkthrough-inactive'));

                if (remainingErrorsInPara.length === 0 || (!Array.from(remainingErrorsInPara).some(el => !el.classList.contains('walkthrough-inactive')) && hasPendingInactive)) {
                    const activeInPara = Array.from(remainingErrorsInPara).filter(el => !el.classList.contains('walkthrough-inactive'));

                    if (activeInPara.length === 0) {
                        const nextInactiveInPara = para.querySelector('.walkthrough-inactive');
                        if (nextInactiveInPara) {
                            nextInactiveInPara.classList.remove('walkthrough-inactive');
                            return;
                        }

                        const currentText = para.innerText.replace(/\s+/g, ' ').trim();
                        const goalText = (para.getAttribute('data-goal') || "").replace(/\s+/g, ' ').trim();

                        if (goalText && currentText !== goalText) {
                            const trigger = document.createElement('span');
                            trigger.id = 'penn-rewrite-trigger';
                            trigger.className = 'bg-blue-50 dark:bg-blue-900/20 px-1 border-b-2 border-blue-500 cursor-pointer animate-pulse ml-1';
                            trigger.innerText = "[Complete Paragraph]";
                            para.appendChild(trigger);
                            showGrammarPopup(trigger, true);
                        } else {
                            unlockNextInCategory(para);
                        }
                    } else {
                        unlockNextInGlobal(lastFixedEl);
                    }
                } else {
                    unlockNextInGlobal(lastFixedEl);
                }
            }

            function unlockNextInGlobal(lastFixedEl) {
                let foundCurrent = false;
                let nextError = null;
                const allErrorsArray = Array.from(document.querySelectorAll('.grammar-error, .spelling-error, .style-suggestion'));

                for (let el of allErrorsArray) {
                    if (el === lastFixedEl) {
                        foundCurrent = true;
                    } else if (foundCurrent && el.classList.contains('walkthrough-inactive')) {
                        nextError = el;
                        break;
                    }
                }

                if (nextError) nextError.classList.remove('walkthrough-inactive');
            }

            function unlockNextInCategory(currentPara) {
                const nextPara = currentPara.nextElementSibling;
                if (nextPara && nextPara.tagName === 'P') {
                    const firstError = nextPara.querySelector('.walkthrough-inactive');
                    if (firstError) {
                        firstError.classList.remove('walkthrough-inactive');
                    } else {
                        unlockNextInCategory(nextPara);
                    }
                }
            }

            if (rewriteParaBtn) {
                rewriteParaBtn.addEventListener('click', () => {
                    if (currentErrorElement) {
                        applyFullParagraphRewrite(currentErrorElement.closest('p'));
                    }
                });
            }

            if (grammarRight) grammarRight.addEventListener('click', applyCorrection);
            if (fixBtnUi) fixBtnUi.addEventListener('click', applyCorrection);

            document.addEventListener('mousedown', (e) => {
                if (grammarPopup && !grammarPopup.contains(e.target) && !e.target.closest('.grammar-error') && !e.target.closest('.spelling-error') && !e.target.closest('.style-suggestion') && e.target.id !== 'penn-rewrite-trigger' && e.target.id !== 'rewrite-paragraph-btn') {
                    grammarPopup.classList.add('hidden');
                }
            });

            // Codex Panel Logic
            const hotspots = {
                agnes: document.getElementById('agnes-hotspot'),
                lucius: document.getElementById('lucius-hotspot'),
                theodora: document.getElementById('theodora-hotspot'),
                elise: document.getElementById('elise-hotspot'),
                dora: document.getElementById('dora-hotspot'),
                amy: document.getElementById('amy-hotspot'),
                mrs: document.getElementById('mrs-hotspot'),
                mentor: document.getElementById('mentor-label'),
                friend: document.getElementById('friend-label'),
                family: document.getElementById('family-label'),
                familyDora: document.getElementById('family-label-dora'),
                familyAmy: document.getElementById('family-label-amy'),
                familyMrs: document.getElementById('family-label-mrs')
            };

            // Connection Key Toggle Logic
            const legendItems = {
                mentor: document.getElementById('legend-mentor'),
                friend: document.getElementById('legend-friend'),
                family: document.getElementById('legend-family')
            };

            Object.entries(legendItems).forEach(([type, element]) => {
                if (element) {
                    element.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const lines = document.querySelectorAll(`.${type}-connection`);
                        const nodes = document.querySelectorAll(`.character-${type}`);

                        // Toggle active state on legend item
                        element.classList.toggle('opacity-40');
                        const isActive = !element.classList.contains('opacity-40');

                        // Toggle lines
                        lines.forEach(line => {
                            line.style.transition = 'opacity 0.4s ease';
                            line.style.opacity = isActive ? '0.9' : '0';
                            line.style.pointerEvents = isActive ? 'auto' : 'none';
                        });

                        // Toggle character nodes
                        nodes.forEach(node => {
                            node.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                            node.style.opacity = isActive ? '1' : '0';
                            node.style.pointerEvents = isActive ? 'auto' : 'none';
                            node.style.transform = isActive ? 'scale(1)' : 'scale(0.5)';
                        });
                    });
                }
            });

            const panels = {
                default: document.getElementById('codex-default'),
                agnes: document.getElementById('codex-agnes'),
                lucius: document.getElementById('codex-lucius'),
                theodora: document.getElementById('codex-theodora'),
                elise: document.getElementById('codex-elise'),
                dora: document.getElementById('codex-dora'),
                amy: document.getElementById('codex-amy'),
                mrs: document.getElementById('codex-mrs'),
                mentor: document.getElementById('codex-mentor'),
                friend: document.getElementById('codex-friend'),
                family: document.getElementById('codex-family'),
                familyDora: document.getElementById('codex-family-dora'),
                familyAmy: document.getElementById('codex-family-amy'),
                familyMrs: document.getElementById('codex-family-mrs')
            };

            let autoScrollInterval;

            const startAutoScroll = (panel) => {
                clearInterval(autoScrollInterval);
                if (!panel) return;

                const scrollSpeed = 1; // Pixels per step
                const scrollDelay = 50; // Milliseconds per step

                autoScrollInterval = setInterval(() => {
                    if (panel.matches(':hover')) return; // Pause on hover

                    if (panel.scrollTop + panel.clientHeight >= panel.scrollHeight) {
                        // Optional: loop back to top or stop? Let's stop naturally, or maybe reset
                        // For now, let's just stop at the bottom. To loop: panel.scrollTop = 0;
                        clearInterval(autoScrollInterval); // Stop at bottom
                    } else {
                        panel.scrollTop += scrollSpeed;
                    }
                }, scrollDelay);
            };

            const activatePanel = (name) => {
                const targetPanel = panels[name];
                const isAlreadyOpen = targetPanel && !targetPanel.classList.contains('hidden');

                // Stop previous auto-scroll
                clearInterval(autoScrollInterval);

                Object.values(panels).forEach(p => {
                    if (p) {
                        p.classList.add('hidden');
                        p.scrollTop = 0; // Reset scroll position
                    }
                });

                if (isAlreadyOpen && name !== 'default') {
                    if (panels.default) panels.default.classList.remove('hidden');
                } else {
                    if (targetPanel) {
                        targetPanel.classList.remove('hidden');
                        // Start auto-scroll after a short delay to let user settle
                        setTimeout(() => startAutoScroll(targetPanel), 1000);
                    } else if (panels.default) {
                        panels.default.classList.remove('hidden');
                    }
                }
            };

            Object.entries(hotspots).forEach(([name, element]) => {
                if (element) {
                    element.addEventListener('click', (e) => {
                        e.stopPropagation();
                        activatePanel(name);
                    });
                }
            });
        });
    </script>

</body>

</html>