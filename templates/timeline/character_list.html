{% extends 'timeline/base.html' %}

{% block title %}Characters - Story Timeline Builder{% endblock %}

{% block extra_css %}
<style>
    .character-card {
        background-color: #ffffff;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }


    .character-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        object-fit: cover;
        background-color: #f8fafc;
        border: 1px solid var(--border-color);
    }

    .role-badge {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        padding: 2px 8px;
        border-radius: 4px;
        font-weight: 700;
        background-color: #f1f5f9;
        color: #475569;
    }

    .character-name {
        font-size: 1rem;
        font-weight: 700;
        color: var(--text-heading);
        text-decoration: none;
    }

    .character-name:hover {
        color: var(--accent);
    }

    .stat-mini {
        font-size: 0.75rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .stat-mini i {
        color: var(--accent);
    }

    .empty-state {
        background-color: #ffffff;
        border-radius: 18px;
        padding: 3rem 1.5rem;
        text-align: center;
        border: 1px dashed var(--border-strong);
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-0">Characters</h2>
        <p class="text-muted small mb-0">Cast of your story universe</p>
    </div>
    <a href="{% url 'character_create' %}" class="btn btn-primary d-flex align-items-center gap-2">
        <i class="bi bi-person-plus-fill"></i>
        <span>Add Character</span>
    </a>
</div>

{% if characters %}
<div class="row g-3">
    {% for character in characters %}
    <div class="col-md-6 col-lg-4">
        <div class="character-card">
            <div class="p-3">
                <div class="d-flex align-items-center mb-3">
                    {% if character.profile_pic_url %}
                    <img src="{{ character.profile_pic_url }}" alt="{{ character.name }}"
                        class="character-avatar shadow-sm">
                    {% else %}
                    <div
                        class="character-avatar d-flex align-items-center justify-content-center bg-light text-muted shadow-sm">
                        <i class="bi bi-person-fill"></i>
                    </div>
                    {% endif %}
                    <div class="ms-3 overflow-hidden">
                        <h5 class="mb-0">
                            <a href="{% url 'character_detail' character.pk %}"
                                class="character-name text-truncate d-block">
                                {{ character.name }}
                            </a>
                        </h5>
                        <span class="role-badge">{{ character.get_role_display }}</span>
                    </div>
                </div>

                {% if character.description %}
                <p class="small text-muted mb-3"
                    style="display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 38px;">
                    {{ character.description }}
                </p>
                {% else %}
                <p class="small text-muted mb-3 italicized" style="height: 38px;">No description provided.</p>
                {% endif %}

                <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                    <div class="stat-mini">
                        <i class="bi bi-calendar-event"></i>
                        <span>{{ character.events.count }} events</span>
                    </div>
                    <div class="d-flex gap-2">
                        <a href="{% url 'character_edit' character.pk %}"
                            class="btn btn-sm btn-outline-secondary py-0 px-2" title="Edit">
                            <i class="bi bi-pencil small"></i>
                        </a>
                        <a href="{% url 'character_detail' character.pk %}"
                            class="btn btn-sm btn-outline-secondary py-0 px-2" title="View Detail">
                            <i class="bi bi-chevron-right small"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <div class="mb-3">
        <i class="bi bi-people fs-1 text-muted opacity-50"></i>
    </div>
    <h4 class="fw-bold">No characters found</h4>
    <p class="text-muted small mx-auto mb-4" style="max-width: 400px;">
        Start building your story's cast. Create your first character to begin tracking their journey and relationships.
    </p>
    <a href="{% url 'character_create' %}" class="btn btn-primary">
        <i class="bi bi-person-plus-fill me-2"></i> Create First Character
    </a>
</div>
{% endif %}
{% endblock %}